<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Notas - Contemporâneo Centro Educacional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
        }
        .modal-backdrop {
            background-color: rgba(0,0,0,0.5);
            transition: opacity 0.3s ease;
            overflow-y: auto;
        }
        .modal-content {
            transition: transform 0.3s ease;
        }
        .active-tab {
            ring: 4px;
            ring-offset: 2px;
            --tw-ring-color: #ef4444; /* red-500 */
            box-shadow: 0 0 0 4px var(--tw-ring-color);
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #16a34a; /* green-500 */
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app-container" class="max-w-7xl mx-auto">
        <header class="bg-green-700 text-white p-6 rounded-xl shadow-lg mb-8 text-center flex justify-between items-center">
            <div>
                <h1 class="text-2xl md:text-4xl font-bold">Contemporâneo Centro Educacional</h1>
                <p class="text-md text-green-100 mt-2">Sistema de Gerenciamento de Notas dos Alunos</p>
            </div>
        </header>

        <div class="bg-white p-6 rounded-xl shadow-md mb-8">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-6">
                <div>
                    <h2 class="text-lg font-semibold text-gray-700 mb-3">Selecione a Turma</h2>
                    <div id="class-tabs" class="flex flex-wrap gap-3"></div>
                </div>
                <div class="flex-grow md:max-w-xs">
                     <h2 class="text-lg font-semibold text-gray-700 mb-3">Buscar Aluno</h2>
                    <input type="text" id="search-input" placeholder="Digite o nome do aluno..." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 transition">
                </div>
            </div>
        </div>

        <main class="bg-white p-4 sm:p-6 rounded-xl shadow-md overflow-x-auto">
             <div class="flex justify-between items-center mb-4">
                <h2 id="class-title" class="text-2xl font-bold text-gray-800">Selecione uma turma para começar</h2>
                <button id="class-summary-btn" class="hidden bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition shadow text-sm font-semibold">✨ Gerar Resumo da Turma com IA</button>
             </div>
            <table class="w-full text-left">
                <thead class="border-b-2 border-gray-200">
                    <tr>
                        <th class="p-4 text-sm font-semibold text-gray-600 uppercase tracking-wider">Aluno</th>
                        <th class="p-4 text-sm font-semibold text-gray-600 uppercase tracking-wider text-center">Média Final</th>
                        <th class="p-4 text-sm font-semibold text-gray-600 uppercase tracking-wider text-center">Ações</th>
                    </tr>
                </thead>
                <tbody id="student-list">
                     <tr><td colspan="3" class="text-center p-8 text-gray-500">Autenticando e carregando dados...</td></tr>
                </tbody>
            </table>
        </main>
        <footer class="text-center text-sm text-gray-500 mt-8 pb-4">
            Criado por Kelvin Radimak
        </footer>
    </div>

    <div id="edit-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden opacity-0">
        <div class="bg-white w-full max-w-2xl rounded-xl shadow-2xl modal-content transform scale-95">
             <div class="p-6 border-b bg-green-600 text-white rounded-t-xl">
                <h2 class="text-2xl font-bold">Editar Notas</h2>
                <p id="edit-student-name" class="text-md text-green-100"></p>
            </div>
            <div id="edit-form-content" class="p-6 space-y-4 max-h-[60vh] overflow-y-auto"></div>
            <div class="p-6 bg-gray-50 rounded-b-xl flex justify-end items-center gap-4">
                <button id="close-edit-modal-btn" class="text-gray-600 font-semibold px-4 py-2 rounded-lg hover:bg-gray-200 transition">Cancelar</button>
                <button id="save-grades-btn" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition shadow">Salvar Alterações</button>
            </div>
        </div>
    </div>
    <div id="report-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden opacity-0">
        <div class="bg-white w-full max-w-2xl rounded-xl shadow-2xl modal-content transform scale-95">
             <div class="p-6 border-b flex justify-between items-start bg-green-600 text-white rounded-t-xl">
                <h2 class="text-2xl font-bold ">Relatório Pedagógico do Aluno</h2>
                <button id="close-report-modal-btn" class="text-green-100 hover:text-white transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div class="max-h-[70vh] overflow-y-auto p-6">
                <div id="report-content"></div>
                <div id="qualitative-assessment" class="mt-6 bg-gray-50 p-4 rounded-lg border">
                    <h3 class="font-semibold text-lg text-gray-800 mb-4">Avaliação Qualitativa</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="font-medium text-gray-700">Participação em aula:</label>
                            <div class="flex flex-wrap gap-4 mt-2" id="q1">
                                <label><input type="radio" name="participation" value="Ativa e contribui" class="mr-1"> Ativa</label>
                                <label><input type="radio" name="participation" value="Ocasional" class="mr-1"> Ocasional</label>
                                <label><input type="radio" name="participation" value="Passiva" class="mr-1"> Passiva</label>
                            </div>
                        </div>
                        <div>
                            <label class="font-medium text-gray-700">Entrega de tarefas:</label>
                            <div class="flex flex-wrap gap-4 mt-2" id="q2">
                                <label><input type="radio" name="homework" value="Sempre no prazo" class="mr-1"> Em dia</label>
                                <label><input type="radio" name="homework" value="Às vezes atrasa" class="mr-1"> Às vezes</label>
                                <label><input type="radio" name="homework" value="Raramente entrega" class="mr-1"> Raramente</label>
                            </div>
                        </div>
                         <div>
                            <label class="font-medium text-gray-700">Comportamento em sala:</label>
                            <div class="flex flex-wrap gap-4 mt-2" id="q3">
                                <label><input type="radio" name="behavior" value="Exemplar" class="mr-1"> Exemplar</label>
                                <label><input type="radio" name="behavior" value="Adequado" class="mr-1"> Adequado</label>
                                <label><input type="radio" name="behavior" value="Requer atenção" class="mr-1"> Requer atenção</label>
                            </div>
                        </div>
                        <div>
                            <label class="font-medium text-gray-700">Interesse pela matéria:</label>
                            <div class="flex flex-wrap gap-4 mt-2" id="q4">
                                <label><input type="radio" name="interest" value="Muito interessado" class="mr-1"> Alto</label>
                                <label><input type="radio" name="interest" value="Interesse mediano" class="mr-1"> Médio</label>
                                <label><input type="radio" name="interest" value="Pouco interessado" class="mr-1"> Baixo</label>
                            </div>
                        </div>
                        <div>
                            <label for="observations" class="font-medium text-gray-700">Observações Adicionais</label>
                            <textarea id="observations" rows="3" class="w-full mt-2 p-2 border rounded-md focus:ring-2 focus:ring-green-500 focus:outline-none" placeholder="Digite aqui pontos importantes sobre o aluno..."></textarea>
                        </div>
                    </div>
                </div>
                 <div id="ai-analysis-container" class="mt-6 p-4 bg-green-50 border-l-4 border-green-500 rounded-r-lg" style="display: none;"></div>
            </div>
             <div class="p-6 bg-gray-50 rounded-b-xl flex justify-between items-center">
                 <button id="ai-analysis-btn" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50 transition shadow disabled:opacity-50">✨ Gerar Análise com IA</button>
                 <button id="print-report-btn" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition shadow" disabled>Imprimir</button>
            </div>
        </div>
    </div>
    <div id="summary-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden opacity-0">
        <div class="bg-white w-full max-w-2xl rounded-xl shadow-2xl modal-content transform scale-95">
             <div class="p-6 border-b flex justify-between items-start bg-green-600 text-white rounded-t-xl">
                <h2 id="summary-title" class="text-2xl font-bold">Resumo da Turma</h2>
                <button id="close-summary-modal-btn" class="text-green-100 hover:text-white transition">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div id="summary-content" class="max-h-[70vh] overflow-y-auto p-6 prose prose-lg"></div>
        </div>
    </div>
    
    <script type="module">
        // Importações do Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged, 
            signInAnonymously
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            setDoc, 
            getDoc,
            onSnapshot
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- DADOS INICIAIS PARA NOVOS USUÁRIOS ---
        const initialStudentData = {
            "6A": [
                { id: 101, name: "ALICE MATILDE SANTOS", grades: [{ final: 10.0 }, { final: 9.0 }, { final: 10.0 }, { sae: 2.5, prova: 5.0 }, null, null]},
                { id: 102, name: "ANA CLARA LIMA ARAÚJO BASTOS", grades: [{ final: 10.0 }, { final: 8.0 }, { final: 10.0 }, { sae: 2.5, prova: 5.0 }, null, null]},
                { id: 103, name: "ANTHONY GABRIEL SOUZA MENEZES", grades: [{ final: 10.0 }, { final: 10.0 }, { final: 10.0 }, { sae: 3.5, prova: 8.0 }, null, null]},
                { id: 104, name: "BEATRIZ VIANA DOS SANTOS", grades: [{ final: 10.0 }, { final: 10.0 }, { final: 10.0 }, { sae: 1.0, prova: 1.0 }, null, null]},
                { id: 105, name: "CARLOS RYAN OLIVEIRA BOMFIM DOS SANTOS", grades: [{ final: 10.0 }, { final: 8.5 }, { final: 10.0 }, { sae: 1.5, prova: 2.0 }, null, null]},
                { id: 106, name: "ENZZO SANTANA FEITOSA CAVALCANTE", grades: [{ final: 10.0 }, { final: 10.0 }, { final: 10.0 }, { sae: 5.0, prova: 10.0 }, null, null]},
                { id: 107, name: "JÉSSICA FREIRE DE CARVALHO LEITE", grades: [{ final: 10.0 }, { final: 8.0 }, { final: 8.0 }, { sae: 0.0, prova: 3.0 }, null, null]},
                { id: 108, name: "JOÃO GUILHERME GONÇALVES SANTOS", grades: [{ final: 10.0 }, { final: 6.5 }, { final: 10.0 }, { sae: 1.5, prova: 5.5 }, null, null]},
                { id: 109, name: "JÚLIA CAROLLINY SOUZA ANDRADE", grades: [{ final: 7.5 }, { final: 6.0 }, { final: 7.0 }, { sae: 1.0, prova: 4.5 }, null, null]},
                { id: 110, name: "KETHLYN SOPHYA SANTOS DE OLIVEIRA", grades: [{ final: 10.0 }, { final: 6.5 }, { final: 10.0 }, { sae: 0.0, prova: 4.0 }, null, null]},
                { id: 111, name: "LUCAS EDUARDO DA SILVA COSTA", grades: [{ final: 7.5 }, { final: 10.0 }, { final: 10.0 }, { sae: 2.5, prova: 5.0 }, null, null]},
                { id: 113, name: "PAULA FABIANA NASCIMENTO BARBOSA DÓRIA", grades: [{ final: 10.0 }, { final: 6.0 }, { final: 6.0 }, { sae: 1.5, prova: 4.0 }, null, null]},
                { id: 114, name: "PHILLIPE RAFAEL SANTANA SANTOS", grades: [{ final: 10.0 }, { final: 10.0 }, { final: 10.0 }, { sae: 3.5, prova: 5.5 }, null, null]},
                { id: 115, name: "TONNY NÉO DA ROCHA", grades: [{ final: 10.0 }, { final: 10.0 }, { final: 10.0 }, { sae: 4.0, prova: 9.0 }, null, null]}
            ],
            "7A": [
                 { id: 201, name: "ADEMIR JÚNIOR ALMEIDA OLIVEIRA", grades: [null, null, null, { sae: 3.5, prova: 7.0 }, null, null]},
                 { id: 202, name: "ALÍCIA MARIA DE SOUZA BARROS", grades: [null, null, null, { sae: 3.5, prova: null }, null, null]},
                 { id: 203, name: "ANNA JÚLIA DOS SANTOS GONÇALVES", grades: [null, null, null, { sae: 3.5, prova: 7.0 }, null, null]},
                 { id: 204, name: "ANTONNY RAPHAEL CARDOSO DOS SANTOS", grades: [null, null, null, null, null, null]},
                 { id: 205, name: "ARTHUR VALDIR BATISTA DOS SANTOS", grades: [null, null, null, { sae: 1.6, prova: 4.75 }, null, null]},
                 { id: 206, name: "ARTHUR FERREIRA DE SANTANA", grades: [null, null, null, { sae: 1.0, prova: 3.0 }, null, null]},
                 { id: 207, name: "ARTHUR MIGUEL DE SANTANA ARAGÃO", grades: [null, null, null, { sae: 2.5, prova: 9.75 }, null, null]},
                 { id: 208, name: "ARTHUR SILVA OLIVEIRA SANTOS", grades: [null, null, null, { sae: 1.6, prova: 6.5 }, null, null]},
                 { id: 209, name: "AYLA SOFHIA MATEUS DOS SANTOS", grades: [null, null, null, { sae: 1.0, prova: 6.5 }, null, null]},
                 { id: 210, name: "CAIO JOAQUIM BORGES MELO", grades: [null, null, null, { sae: 3.5, prova: 5.0 }, null, null]},
                 { id: 211, name: "CAIO LUCAS DE SANTANA", grades: [null, null, null, { sae: 1.6, prova: 5.0 }, null, null]},
                 { id: 212, name: "CAUÃ VICTOR NOBRE FLORIANO", grades: [null, null, null, { sae: 1.5, prova: 4.5 }, null, null]},
                 { id: 213, name: "CAUÊ SOUZA MATOS FILHO", grades: [null, null, null, { sae: 2.0, prova: 2.5 }, null, null]},
                 { id: 214, name: "GUILHERME FERNANDES SANTOS BARROS", grades: [null, null, null, { sae: 0.0, prova: 10.0 }, null, null]},
                 { id: 215, name: "JEFFERSON CAUÃ RODRIGUES BERNARDES", grades: [null, null, null, { sae: 4.0, prova: 10.0 }, null, null]},
                 { id: 216, name: "JENNIFER LORENA RODRIGUES DOS SANTOS", grades: [null, null, null, { sae: 2.5, prova: 6.75 }, null, null]},
                 { id: 217, name: "JOÃO PEDRO SANTOS ROSA MARTINS", grades: [null, null, null, { sae: 2.5, prova: 8.0 }, null, null]},
                 { id: 218, name: "JÚLIA EXPEDITA SÁ DANTAS", grades: [null, null, null, { sae: 3.0, prova: null }, null, null]},
                 { id: 219, name: "LETÍCIA MERIELEN SANTOS DE AQUINO", grades: [null, null, null, { sae: 1.6, prova: 5.0 }, null, null]},
                 { id: 220, name: "LUIZ GUILHERME DOS SANTOS FONSECA", grades: [null, null, null, { sae: 1.0, prova: 5.75 }, null, null]},
                 { id: 221, name: "MARIA AGATHA SANTOS SILVA", grades: [null, null, null, { sae: 3.5, prova: 5.0 }, null, null]},
                 { id: 222, name: "MARIA EDUARDA SANTOS", grades: [null, null, null, { sae: 3.5, prova: 7.75 }, null, null]},
                 { id: 223, name: "MICAELLY VITÓRIA SANTOS DO AMOR DIVINO", grades: [null, null, null, { sae: 1.0, prova: 6.75 }, null, null]},
                 { id: 224, name: "SOPHIA SANTOS FRANÇA DE OLIVEIRA", grades: [null, null, null, { sae: 1.0, prova: 10.0 }, null, null]},
                 { id: 225, name: "WELLINGTON SILVA DOS SANTOS", grades: [null, null, null, { sae: 1.0, prova: 5.75 }, null, null]},
                 { id: 226, name: "WENDELL MENEZES SANTOS GOIS", grades: [null, null, null, { sae: 2.5, prova: 4.0 }, null, null]}
            ],
             "8A": [
                { id: 301, name: "ALICIA BARBOSA FONTES", grades: [{ final: 10 }, { final: 10 }, { final: 10 }, { sae: 4.5, prova: 8.5 }, null, null]},
                { id: 302, name: "ALICY DOS SANTOS MONTEIRO", grades: [null, null, null, { sae: 3.5, prova: 3.0 }, null, null]},
                { id: 303, name: "ANTÔNIO CÉSAR FONTES DE JESUS", grades: [null, null, null, { sae: 2.0, prova: null }, null, null]},
                { id: 304, name: "ARTHUR GABRIEL CORREIA PASSOS", grades: [null, null, null, { sae: 1.0, prova: 2.0 }, null, null]},
                { id: 305, name: "CLAUDIO VINICIUS SILVA BISPO", grades: [null, null, null, { sae: 1.0, prova: 2.0 }, null, null]},
                { id: 306, name: "GABRIEL DA SILVA SANTOS GUIMARÃES", grades: [null, null, null, { sae: 2.5, prova: 4.0 }, null, null]},
                { id: 307, name: "GUSTAVO CAUÊ ANDRADE DE SÁ", grades: [null, null, null, { sae: 3.4, prova: 3.0 }, null, null]},
                { id: 308, name: "HELENA VICTÓRIA MATTOS DA SILVA", grades: [null, null, null, { sae: 3.5, prova: 3.5 }, null, null]},
                { id: 309, name: "HELENA SANTOS RODRIGUES", grades: [null, null, null, { sae: 3.5, prova: 2.0 }, null, null]},
                { id: 311, name: "JOÃO CARLOS DE SANTANA GONÇALVES", grades: [null, null, null, { sae: 2.0, prova: 3.5 }, null, null]},
                { id: 312, name: "JOÃO GUILHERME SOUZA DA SILVA", grades: [null, null, null, { sae: 2.0, prova: 2.0 }, null, null]},
                { id: 313, name: "JULIA GABRIELLY DE FARIA ALVES", grades: [null, null, null, { sae: 2.0, prova: 2.0 }, null, null]},
                { id: 314, name: "JÚLIA VITÓRIA PEREIRA DOS SANTOS", grades: [null, null, null, { sae: 3.5, prova: 6.0 }, null, null]},
                { id: 315, name: "KAIO DA SILVA ANUNCIAÇÃO", grades: [null, null, null, { sae: 3.5, prova: 3.0 }, null, null]},
                { id: 316, name: "KAUÃ FELIPE DE OLIVEIRA ESTEVAM", grades: [null, null, null, { sae: 1.0, prova: null }, null, null]},
                { id: 317, name: "KAUANNY RODRIGUES SANTOS", grades: [null, null, null, { sae: 3.5, prova: 4.0 }, null, null]},
                { id: 318, name: "LAVÍNIA LAURENTINO CARDOSO", grades: [null, null, null, { sae
