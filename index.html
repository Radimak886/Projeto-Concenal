<!DOCTYPE html>
<html lang="pt-BR" id="html-lang">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>INFINITY MIND's</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/12.4.2/math.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s;
        }
        /* --- Keyframe Animations --- */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes slideInDown {
          from { transform: translateY(-30px); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        @keyframes toastIn {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes toastOut {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(100%); opacity: 0; }
        }

        .calculator-card, .menu-card {
            background-color: #1F2937; /* bg-gray-800 */
            border-radius: 16px;
            padding: 24px;
            border: 1px solid #374151; /* border-gray-700 */
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            opacity: 0;
            animation: popIn 0.5s ease-out forwards;
        }
        .menu-card:hover {
            transform: translateY(-5px);
            border-color: #8B5CF6; /* purple-500 */
            box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.2);
        }
        .menu-card {
            cursor: grab;
            text-align: center;
            align-items: center;
            justify-content: center;
        }
        .menu-card:active {
            cursor: grabbing;
        }
        .menu-card-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            line-height: 1;
        }
        .input-field, .textarea-field, .select-field {
            width: 100%;
            padding: 10px;
            background-color: #374151; /* bg-gray-700 */
            border: 1px solid #4B5563; /* border-gray-600 */
            color: #F9FAFB; /* text-gray-50 */
            border-radius: 8px;
            margin-top: 6px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .textarea-field { min-height: 120px; resize: vertical; }
        .input-field:focus, .textarea-field:focus, .select-field:focus {
            outline: none;
            border-color: #8B5CF6; /* purple-500 */
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3);
        }
        .calc-button {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            background-image: linear-gradient(to right, #8B5CF6, #EC4899);
            background-size: 200% auto;
        }
        .calc-button:hover { background-position: right center; transform: scale(1.02); }
        .calc-button:active { transform: scale(0.98); }
        .calc-button:disabled { opacity: 0.5; cursor: not-allowed; transform: scale(1); }
        .gemini-button { background-image: linear-gradient(to right, #10B981, #34D399); }
        .result-box {
            margin-top: 16px; padding: 16px; background-color: #111827; border: 1px solid #374151; border-radius: 8px; text-align: left; font-weight: 500; min-height: 52px; flex-grow: 1; line-height: 1.6; color: #D1D5DB; position: relative;
        }
        .result-box.fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .result-box strong { color: #A78BFA; }
        .basic-calc-grid button { background-color: #374151; border: 1px solid #4B5563; color: white; border-radius: 8px; font-size: 1.2rem; transition: background-color 0.2s, transform 0.2s; }
        .basic-calc-grid button:hover { background-color: #4B5563; transform: scale(1.05); }
        .basic-calc-grid button:active { transform: scale(0.98); }
        .basic-calc-grid .operator { background-image: linear-gradient(to right, #1E3A8A, #1E40AF); color: white; }
        .basic-calc-grid .equal { background-image: linear-gradient(to right, #8B5CF6, #EC4899); color: white; grid-column: span 2; }
        header h1 { animation: slideInDown 0.8s ease-out; }
        header p { animation: slideInDown 0.8s ease-out 0.2s; animation-fill-mode: backwards; }
        .tool-page { display: none; animation: fadeIn 0.6s ease-out; }
        .tool-content-wrapper {
            width: 100%;
            max-width: 42rem; /* max-w-xl */
            margin-left: auto;
            margin-right: auto;
        }
        .back-button, .chat-option-button {
            background: none; border: 1px solid #4B5563; color: #D1D5DB; padding: 8px 16px; border-radius: 8px; cursor: pointer; transition: all 0.3s;
        }
        .back-button:hover, .chat-option-button:hover { background-color: #374151; color: white; }
        .loader {
            width: 50px; height: 50px; border: 5px solid #4B5563; border-top-color: #8B5CF6; border-radius: 50%; animation: spin 1s linear infinite; margin: 20px auto;
        }
        #audio-player-container {
            margin-top: 1rem;
        }
        #audio-player-container audio {
            width: 100%;
        }
        .file-upload-label {
            display: block;
            padding: 12px;
            background-color: #374151;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s;
        }
        .file-upload-label:hover {
            background-color: #4B5563;
        }
        #image-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 1rem;
            border-radius: 8px;
        }
        /* Mind Map Styles */
        #mindMapContainer {
            width: 100%;
            min-height: 400px;
            overflow: auto;
        }
        #mindMapSvg {
            width: 100%;
            height: 100%;
        }
        .mind-map-node {
            transition: transform 0.2s ease-in-out;
        }
        .mind-map-node:hover {
            transform: scale(1.05);
            cursor: pointer;
        }
        /* Copy Button */
        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: #374151;
            border: 1px solid #4B5563;
            color: #D1D5DB;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            opacity: 0;
            visibility: hidden;
        }
        .result-box:hover .copy-btn {
            opacity: 1;
            visibility: visible;
        }
        .copy-btn:hover {
            background-color: #4B5563;
            color: white;
        }
        /* Toast Notification */
        #toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #10B981;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        #toast.show {
            visibility: visible;
            animation: toastIn 0.3s ease-out forwards;
        }
        #toast.hide {
            animation: toastOut 0.3s ease-in forwards;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <div id="toast"></div>

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-10 relative">
            <h1 class="text-5xl md:text-6xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-400 to-pink-500 py-2">
                INFINITY MIND's
            </h1>
            <p data-lang-key="subtitle" class="text-lg text-gray-400 mt-2">Suas ferramentas de IA para estudos, finanças e criatividade.</p>
            <div class="absolute top-0 right-0">
                <select id="language-switcher" class="select-field !w-auto !mt-0" onchange="changeLanguage(this.value)">
                    <option value="pt-br">🇧🇷 Português</option>
                    <option value="en">🇬🇧 English</option>
                    <option value="es">🇪🇸 Español</option>
                    <option value="it">🇮🇹 Italiano</option>
                    <option value="de">🇩🇪 Deutsch</option>
                </select>
            </div>
        </header>

        <!-- Home Page / Menu -->
        <main id="home-page">
            <div class="text-center mb-12">
                <h2 data-lang-key="welcome_title" class="text-3xl font-bold text-white mb-2">Bem-vindo ao INFINITY MIND's</h2>
                <p data-lang-key="welcome_desc" class="text-gray-400 max-w-2xl mx-auto">Sua central de ferramentas inteligentes para resolver desde problemas matemáticos complexos até cálculos do dia a dia. Explore nossas calculadoras e conversores, potencializados com IA para oferecer mais do que apenas respostas. Escolha uma ferramenta abaixo para começar.</p>
            </div>
            <div id="tool-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                <div class="menu-card" data-tool-id="tool-graph-plotter" onclick="showTool('tool-graph-plotter')"><div class="menu-card-icon">📈</div><h3 data-lang-key="tool_graph_plotter_title" class="text-xl font-semibold text-white">Gráfico de Funções</h3><p data-lang-key="tool_graph_plotter_desc" class="text-gray-400">Visualize equações em um gráfico.</p></div>
                <div class="menu-card" data-tool-id="tool-mind-map" onclick="showTool('tool-mind-map')"><div class="menu-card-icon">🗺️</div><h3 data-lang-key="tool_mind_map_title" class="text-xl font-semibold text-white">Gerador de Mapas Mentais</h3><p data-lang-key="tool_mind_map_desc" class="text-gray-400">Transforme assuntos em mapas visuais.</p></div>
                <div class="menu-card" data-tool-id="tool-formula-explainer" onclick="showTool('tool-formula-explainer')"><div class="menu-card-icon">📜</div><h3 data-lang-key="tool_formula_explainer_title" class="text-xl font-semibold text-white">Explicador de Fórmulas</h3><p data-lang-key="tool_formula_explainer_desc" class="text-gray-400">Entenda qualquer fórmula matemática.</p></div>
                <div class="menu-card" data-tool-id="tool-solve-by-photo" onclick="showTool('tool-solve-by-photo')"><div class="menu-card-icon">📸</div><h3 data-lang-key="tool_solve_by_photo_title" class="text-xl font-semibold text-white">Resolver por Foto</h3><p data-lang-key="tool_solve_by_photo_desc" class="text-gray-400">Envie a foto de um problema e a IA resolve.</p></div>
                <div class="menu-card" data-tool-id="tool-study-planner" onclick="showTool('tool-study-planner')"><div class="menu-card-icon">🗓️</div><h3 data-lang-key="tool_study_planner_title" class="text-xl font-semibold text-white">Planejador de Estudos</h3><p data-lang-key="tool_study_planner_desc" class="text-gray-400">Crie um plano de estudos personalizado.</p></div>
                <div class="menu-card" data-tool-id="tool-image-gen" onclick="showTool('tool-image-gen')"><div class="menu-card-icon">🎨</div><h3 data-lang-key="tool_image_gen_title" class="text-xl font-semibold text-white">Gerador de Imagens</h3><p data-lang-key="tool_image_gen_desc" class="text-gray-400">Crie imagens a partir de texto com IA.</p></div>
                <div class="menu-card" data-tool-id="tool-live-chat" onclick="showTool('tool-live-chat')"><div class="menu-card-icon">💬</div><h3 data-lang-key="tool_live_chat_title" class="text-xl font-semibold text-white">Tutor IA ao Vivo</h3><p data-lang-key="tool_live_chat_desc" class="text-gray-400">Tire suas dúvidas em tempo real.</p></div>
                <div class="menu-card" data-tool-id="tool-exercises" onclick="showTool('tool-exercises')"><div class="menu-card-icon">✍️</div><h3 data-lang-key="tool_exercises_title" class="text-xl font-semibold text-white">Gerador de Exercícios</h3><p data-lang-key="tool_exercises_desc" class="text-gray-400">Crie listas de exercícios personalizadas.</p></div>
                <div class="menu-card" data-tool-id="tool-financial" onclick="showTool('tool-financial')"><div class="menu-card-icon">💰</div><h3 data-lang-key="tool_financial_title" class="text-xl font-semibold text-white">Planejador Financeiro</h3><p data-lang-key="tool_financial_desc" class="text-gray-400">Dicas de IA para suas finanças.</p></div>
                <div class="menu-card" data-tool-id="tool-word-problem" onclick="showTool('tool-word-problem')"><div class="menu-card-icon">🧠</div><h3 data-lang-key="tool_word_problem_title" class="text-xl font-semibold text-white">Solucionador de Problemas</h3><p data-lang-key="tool_word_problem_desc" class="text-gray-400">Deixe a IA resolver problemas para você.</p></div>
                <div class="menu-card" data-tool-id="tool-summarizer" onclick="showTool('tool-summarizer')"><div class="menu-card-icon">📚</div><h3 data-lang-key="tool_summarizer_title" class="text-xl font-semibold text-white">Resumo de Assuntos</h3><p data-lang-key="tool_summarizer_desc" class="text-gray-400">Resumos de tópicos para estudantes.</p></div>
                <div class="menu-card" data-tool-id="tool-equations" onclick="showTool('tool-equations')"><div class="menu-card-icon">🔢</div><h3 data-lang-key="tool_equations_title" class="text-xl font-semibold text-white">Sistemas de Equações</h3><p data-lang-key="tool_equations_desc" class="text-gray-400">Resolva sistemas de 1º grau.</p></div>
                <div class="menu-card" data-tool-id="tool-currency" onclick="showTool('tool-currency')"><div class="menu-card-icon">💱</div><h3 data-lang-key="tool_currency_title" class="text-xl font-semibold text-white">Conversor de Moedas</h3><p data-lang-key="tool_currency_desc" class="text-gray-400">Câmbio em tempo real.</p></div>
                <div class="menu-card" data-tool-id="tool-basic-calc" onclick="showTool('tool-basic-calc')"><div class="menu-card-icon">🧮</div><h3 data-lang-key="tool_basic_calc_title" class="text-xl font-semibold text-white">Calculadora Básica</h3><p data-lang-key="tool_basic_calc_desc" class="text-gray-400">Para cálculos rápidos.</p></div>
                <div class="menu-card" data-tool-id="tool-bmi" onclick="showTool('tool-bmi')"><div class="menu-card-icon">💪</div><h3 data-lang-key="tool_bmi_title" class="text-xl font-semibold text-white">Calculadora de IMC</h3><p data-lang-key="tool_bmi_desc" class="text-gray-400">Monitore sua saúde.</p></div>
                <div class="menu-card" data-tool-id="tool-quadratic" onclick="showTool('tool-quadratic')"><div class="menu-card-icon">📈</div><h3 data-lang-key="tool_quadratic_title" class="text-xl font-semibold text-white">Equação Quadrática</h3><p data-lang-key="tool_quadratic_desc" class="text-gray-400">Resolva equações de 2º grau.</p></div>
                <div class="menu-card" data-tool-id="tool-percentage" onclick="showTool('tool-percentage')"><div class="menu-card-icon">📊</div><h3 data-lang-key="tool_percentage_title" class="text-xl font-semibold text-white">Calculadora de Porcentagem</h3><p data-lang-key="tool_percentage_desc" class="text-gray-400">Calcule porcentagens.</p></div>
                <div class="menu-card" data-tool-id="tool-temperature" onclick="showTool('tool-temperature')"><div class="menu-card-icon">🌡️</div><h3 data-lang-key="tool_temperature_title" class="text-xl font-semibold text-white">Conversor de Temperatura</h3><p data-lang-key="tool_temperature_desc" class="text-gray-400">Celsius e Fahrenheit.</p></div>
            </div>
        </main>

        <!-- Tools Container -->
        <div id="tools-container" style="display: none;">
            <div class="mb-6">
                <button onclick="showHome()" class="back-button">&larr; <span data-lang-key="back_to_menu">Voltar ao Menu</span></button>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <div id="tool-graph-plotter" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="graph_plotter_title" class="text-2xl font-semibold mb-4 text-center text-white">✨ Gráfico de Funções</h2><p data-lang-key="graph_plotter_desc" class="text-center text-gray-400 mb-4">Digite uma função de 'x' para visualizar seu gráfico.</p><div><label for="functionInput" class="font-medium" data-lang-key="function_label">Função f(x) =</label><input type="text" id="functionInput" class="input-field" data-lang-key="function_placeholder" placeholder="Ex: x^2, sin(x), 2*x + 1"></div><div class="grid grid-cols-2 gap-4 mt-4"><div><label for="xMin" class="font-medium" data-lang-key="x_min_label">X Mínimo</label><input type="number" id="xMin" class="input-field" value="-10"></div><div><label for="xMax" class="font-medium" data-lang-key="x_max_label">X Máximo</label><input type="number" id="xMax" class="input-field" value="10"></div></div><button onclick="plotFunction()" class="calc-button gemini-button mt-6" data-lang-key="plot_graph_btn">Gerar Gráfico</button><div class="result-box mt-4 bg-gray-800 p-2 rounded-lg"><canvas id="functionChart"></canvas></div></div></div>
                <div id="tool-mind-map" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="mind_map_title" class="text-2xl font-semibold mb-4 text-center text-white">✨ Gerador de Mapas Mentais</h2><p data-lang-key="mind_map_desc" class="text-center text-gray-400 mb-4">Digite um assunto para gerar um mapa mental visual e dinâmico.</p><div><label for="mindMapSubject" class="font-medium" data-lang-key="mind_map_subject_label">Assunto:</label><input type="text" id="mindMapSubject" class="input-field" data-lang-key="mind_map_placeholder" placeholder="Ex: Sistema Solar, Revolução Industrial"></div><button id="generateMindMapBtn" onclick="generateMindMap()" class="calc-button gemini-button mt-6" data-lang-key="generate_mind_map_btn">Gerar Mapa Mental</button><div id="mindMapContainer" class="result-box"></div></div></div>
                <div id="tool-formula-explainer" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="formula_explainer_title" class="text-2xl font-semibold mb-4 text-center text-white">✨ Explicador de Fórmulas</h2><p data-lang-key="formula_explainer_desc" class="text-center text-gray-400 mb-4">Digite o nome de uma fórmula matemática e a IA explicará para você.</p><div><label for="formulaInput" class="font-medium" data-lang-key="formula_name_label">Nome da Fórmula:</label><input type="text" id="formulaInput" class="input-field" data-lang-key="formula_placeholder" placeholder="Ex: Teorema de Pitágoras, Fórmula de Bhaskara"></div><button id="explainFormulaBtn" onclick="explainFormula()" class="calc-button gemini-button mt-6" data-lang-key="explain_btn">Explicar Fórmula</button><div id="formulaResult" class="result-box"></div><div id="formulaAudioPlayerContainer" class="audio-player-container"></div></div></div>
                <div id="tool-solve-by-photo" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="solve_by_photo_title" class="text-2xl font-semibold mb-4 text-center text-white">✨ Resolver Problema por Foto</h2><p data-lang-key="solve_by_photo_desc" class="text-center text-gray-400 mb-4">Envie uma foto de um problema matemático e a IA irá resolvê-lo.</p><div><label for="imageUpload" class="file-upload-label" data-lang-key="choose_image_btn">Escolher Imagem</label><input type="file" id="imageUpload" class="hidden" accept="image/*" onchange="previewImage(event)"></div><div class="text-center"><img id="image-preview" class="hidden mx-auto"></div><button id="solveByPhotoBtn" onclick="solveByPhoto()" class="calc-button gemini-button mt-6" data-lang-key="solve_photo_btn">Resolver com IA</button><div id="solveByPhotoResult" class="result-box" data-lang-key="solve_by_photo_result_placeholder">A solução para o problema na imagem aparecerá aqui.</div></div></div>
                <div id="tool-study-planner" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="study_planner_title" class="text-2xl font-semibold mb-4 text-center text-white">✨ Planejador de Estudos</h2><p data-lang-key="study_planner_desc" class="text-center text-gray-400 mb-4">Crie um plano de estudos estruturado com a ajuda da IA.</p><div><label for="studySubject" class="font-medium" data-lang-key="study_subject_label">Matéria:</label><input type="text" id="studySubject" class="input-field" data-lang-key="study_subject_placeholder" placeholder="Ex: Álgebra Linear"></div><div class="mt-4"><label for="studyDuration" class="font-medium" data-lang-key="study_duration_label">Duração:</label><input type="text" id="studyDuration" class="input-field" data-lang-key="study_duration_placeholder" placeholder="Ex: 1 semana, 15 dias"></div><button id="generatePlanBtn" onclick="generateStudyPlan()" class="calc-button gemini-button mt-6" data-lang-key="generate_plan_btn">Gerar Plano de Estudos</button><div id="studyPlanResult" class="result-box"></div></div></div>
                <div id="tool-word-problem" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="word_problem_title" class="text-2xl font-semibold mb-4 text-center text-white">✨ Solucionador de Problemas de Matemática</h2><p data-lang-key="word_problem_desc" class="text-center text-gray-400 mb-4">Escreva um problema de matemática e deixe a IA resolvê-lo para você.</p><div><label for="wordProblem" class="font-medium" data-lang-key="your_problem_label">Seu problema:</label><textarea id="wordProblem" class="textarea-field" data-lang-key="word_problem_placeholder" placeholder="Ex: Maria tem 3 maçãs e João lhe dá mais 5. Com quantas maçãs Maria fica?"></textarea></div><button id="solveProblemBtn" onclick="solveWordProblem()" class="calc-button gemini-button mt-6" data-lang-key="solve_problem_btn">Resolver Problema</button><div id="wordProblemResult" class="result-box" data-lang-key="word_problem_result_placeholder">A explicação passo a passo aparecerá aqui.</div><div id="wpAudioPlayerContainer" class="audio-player-container"></div></div></div>
                <div id="tool-summarizer" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="summarizer_title" class="text-2xl font-semibold mb-4 text-center text-white">✨ Gerador de Resumos</h2><p data-lang-key="summarizer_desc" class="text-center text-gray-400 mb-4">Digite um tópico e a IA criará um resumo ideal para estudantes até o 9º ano.</p><div><label for="subjectInput" class="font-medium" data-lang-key="your_subject_label">Qual é o assunto?</label><input type="text" id="subjectInput" class="input-field" data-lang-key="summarizer_placeholder" placeholder="Ex: Revolução Francesa, Fotossíntese, Teorema de Pitágoras"></div><button id="summarizeBtn" onclick="summarizeSubject()" class="calc-button gemini-button mt-6" data-lang-key="summarize_btn">Resumir</button><div id="summarizerResult" class="result-box" data-lang-key="summarizer_result_placeholder">O resumo sobre o assunto aparecerá aqui.</div><div id="summarizerAudioPlayerContainer" class="audio-player-container"></div></div></div>
                <div id="tool-image-gen" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="image_gen_title" class="text-2xl font-semibold mb-4 text-center text-white">✨ Gerador de Imagens com IA</h2><p data-lang-key="image_gen_desc" class="text-center text-gray-400 mb-4">Descreva a imagem que você quer criar.</p><div><label for="imagePrompt" class="font-medium" data-lang-key="image_prompt_label">Descrição da Imagem:</label><input type="text" id="imagePrompt" class="input-field" data-lang-key="image_gen_placeholder" placeholder="Ex: um astronauta surfando em um anel de saturno, arte digital"></div><button id="generateImageBtn" onclick="generateImage()" class="calc-button gemini-button mt-6" data-lang-key="generate_image_btn">Gerar Imagem</button><div id="imageResult" class="result-box min-h-[256px] flex justify-center items-center"><span data-lang-key="image_result_placeholder">Sua imagem aparecerá aqui.</span></div></div></div>
                <div id="tool-live-chat" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><div class="flex justify-between items-center mb-4"><h2 data-lang-key="live_chat_title" class="text-2xl font-semibold text-white">💬 Tutor IA ao Vivo</h2><button class="chat-option-button" onclick="downloadChat()" data-lang-key="download_chat_btn">Baixar Conversa</button></div><p data-lang-key="live_chat_desc" class="text-center text-gray-400 mb-4">Faça uma pergunta e receba uma resposta instantânea.</p><div id="lockout-message" class="text-center p-3 bg-red-800 text-white rounded-lg mb-4" style="display: none;"></div><div id="chatWindow" class="result-box h-64 overflow-y-auto"></div><div class="mt-4 flex flex-col sm:flex-row gap-2"><div class="flex-grow"><label for="chatInput" class="sr-only">Chat Input</label><input type="text" id="chatInput" class="input-field !mt-0" data-lang-key="chat_placeholder" placeholder="Digite sua pergunta..."></div><div class="flex items-center gap-2"><label for="responseStyle" class="sr-only" data-lang-key="response_style_label">Estilo da Resposta</label><select id="responseStyle" class="select-field !mt-0"><option value="objetiva" data-lang-key="style_objective">Objetiva</option><option value="detalhada" data-lang-key="style_detailed">Detalhada</option></select><button id="sendChatBtn" onclick="sendChatMessage()" class="calc-button !w-auto px-6" data-lang-key="send_btn">Enviar</button></div></div></div></div>
                <div id="tool-financial" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="financial_title" class="text-2xl font-semibold mb-4 text-center text-white">💰 Planejador Financeiro com IA</h2><p data-lang-key="financial_desc" class="text-center text-gray-400 mb-4">Receba dicas sobre investimentos e planejamento pessoal. (Isso não é um conselho financeiro real).</p><div><label for="financialQuery" class="font-medium" data-lang-key="financial_query_label">Sua meta ou dúvida:</label><textarea id="financialQuery" class="textarea-field" data-lang-key="financial_placeholder" placeholder="Ex: Como posso começar a economizar para comprar um carro?"></textarea></div><button id="getAdviceBtn" onclick="getFinancialAdvice()" class="calc-button gemini-button mt-6" data-lang-key="get_advice_btn">Obter Dicas</button><div id="financialResult" class="result-box"></div></div></div>
                <div id="tool-exercises" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="exercises_title" class="text-2xl font-semibold mb-4 text-center text-white">✍️ Gerador de Exercícios</h2><p data-lang-key="exercises_desc" class="text-center text-gray-400 mb-4">Crie exercícios sobre qualquer assunto.</p><div><label for="exerciseSubject" class="font-medium" data-lang-key="subject_label">Assunto:</label><input type="text" id="exerciseSubject" class="input-field" data-lang-key="subject_placeholder" placeholder="Ex: Revolução Industrial"></div><div class="grid grid-cols-3 gap-4 mt-4"><div class="col-span-1"><label for="exerciseCount" class="font-medium" data-lang-key="question_count_label">Nº de Questões</label><input type="number" id="exerciseCount" class="input-field" value="5"></div><div class="col-span-1"><label for="exerciseLevel" class="font-medium" data-lang-key="difficulty_label">Nível</label><select id="exerciseLevel" class="select-field"><option value="fácil" data-lang-key="level_easy">Fácil</option><option value="médio" data-lang-key="level_medium">Médio</option><option value="difícil" data-lang-key="level_hard">Difícil</option></select></div><div class="col-span-1"><label for="exerciseType" class="font-medium" data-lang-key="type_label">Tipo</label><select id="exerciseType" class="select-field"><option value="objetivas" data-lang-key="type_objective">Objetivas</option><option value="subjetivas" data-lang-key="type_subjective">Subjetivas</option><option value="mistas" data-lang-key="type_mixed">Mistas</option></select></div></div><button id="generateExercisesBtn" onclick="generateExercises()" class="calc-button gemini-button mt-6" data-lang-key="generate_exercises_btn">Gerar Exercícios</button><div id="exerciseResult" class="result-box"></div></div></div>
                <div id="tool-equations" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="equations_title" class="text-2xl font-semibold mb-4 text-center text-white">🔢 Calculadora de Sistemas de Equações</h2><p data-lang-key="equations_desc" class="text-center text-gray-400 mb-4">Resolva sistemas de equações lineares (1º grau) com duas incógnitas.</p><div class="space-y-4 my-6"><div class="flex items-center justify-center gap-2 text-xl font-mono"><input type="number" id="eq_a1" class="input-field !mt-0 w-20 text-center" placeholder="a₁"><span class="text-gray-400">x +</span><input type="number" id="eq_b1" class="input-field !mt-0 w-20 text-center" placeholder="b₁"><span class="text-gray-400">y =</span><input type="number" id="eq_c1" class="input-field !mt-0 w-20 text-center" placeholder="c₁"></div><div class="flex items-center justify-center gap-2 text-xl font-mono"><input type="number" id="eq_a2" class="input-field !mt-0 w-20 text-center" placeholder="a₂"><span class="text-gray-400">x +</span><input type="number" id="eq_b2" class="input-field !mt-0 w-20 text-center" placeholder="b₂"><span class="text-gray-400">y =</span><input type="number" id="eq_c2" class="input-field !mt-0 w-20 text-center" placeholder="c₂"></div></div><button onclick="solveSystemOfEquations()" class="calc-button mt-6" data-lang-key="solve_btn">Resolver</button><div id="equationsResult" class="result-box text-center"></div></div></div>
                <div id="tool-currency" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="currency_title" class="text-2xl font-semibold mb-4 text-center text-white">Conversor de Moedas</h2><div><label for="amount" class="font-medium" data-lang-key="amount_label">Valor</label><input type="number" id="amount" class="input-field" placeholder="100"></div><div class="mt-4"><label for="from_currency" class="font-medium" data-lang-key="from_currency_label">De</label><select id="from_currency" class="select-field"></select></div><div class="mt-4"><label for="to_currency" class="font-medium" data-lang-key="to_currency_label">Para</label><select id="to_currency" class="select-field"></select></div><button onclick="convertCurrency()" class="calc-button mt-6" data-lang-key="convert_btn">Converter</button><div id="currencyResult" class="result-box text-center"></div></div></div>
                <div id="tool-basic-calc" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="basic_calc_title" class="text-2xl font-semibold mb-4 text-center text-white">Calculadora Básica</h2><input type="text" id="basicCalcDisplay" class="input-field text-right text-2xl mb-4" readonly><div class="grid grid-cols-4 gap-2 basic-calc-grid"><button onclick="appendToDisplay('7')">7</button> <button onclick="appendToDisplay('8')">8</button> <button onclick="appendToDisplay('9')">9</button> <button class="operator" onclick="appendToDisplay('/')">/</button><button onclick="appendToDisplay('4')">4</button> <button onclick="appendToDisplay('5')">5</button> <button onclick="appendToDisplay('6')">6</button> <button class="operator" onclick="appendToDisplay('*')">*</button><button onclick="appendToDisplay('1')">1</button> <button onclick="appendToDisplay('2')">2</button> <button onclick="appendToDisplay('3')">3</button> <button class="operator" onclick="appendToDisplay('-')">-</button><button onclick="appendToDisplay('0')">0</button> <button onclick="appendToDisplay('.')">.</button> <button onclick="clearDisplay()">C</button> <button class="operator" onclick="appendToDisplay('+')">+</button><button class="equal" onclick="calculateResult()">=</button></div></div></div>
                <div id="tool-bmi" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="bmi_title" class="text-2xl font-semibold mb-4 text-center text-white">Calculadora de IMC</h2><div><label for="weight" class="font-medium" data-lang-key="weight_label">Peso (kg)</label><input type="number" id="weight" class="input-field" placeholder="Ex: 70"></div><div class="mt-4"><label for="height" class="font-medium" data-lang-key="height_label">Altura (cm)</label><input type="number" id="height" class="input-field" placeholder="Ex: 175"></div><button onclick="calculateBMI()" class="calc-button mt-6" data-lang-key="calculate_btn">Calcular</button><div id="bmiResult" class="result-box"></div><button id="bmiTipsBtn" onclick="getBmiTips()" class="calc-button gemini-button mt-4" style="display: none;" data-lang-key="get_tips_btn">✨ Obter Dicas de Bem-Estar</button><div id="bmiTipsResult" class="result-box" style="display: none;"></div></div></div>
                <div id="tool-quadratic" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="quadratic_title" class="text-2xl font-semibold mb-4 text-center text-white">Equação Quadrática</h2><p data-lang-key="quadratic_desc" class="text-center text-gray-400 mb-4 text-sm">Resolva: ax² + bx + c = 0</p><div class="grid grid-cols-3 gap-2"><div><label for="coeffA" class="font-medium">a</label><input type="number" id="coeffA" class="input-field" placeholder="1"></div><div><label for="coeffB" class="font-medium">b</label><input type="number" id="coeffB" class="input-field" placeholder="-3"></div><div><label for="coeffC" class="font-medium">c</label><input type="number" id="coeffC" class="input-field" placeholder="2"></div></div><button onclick="solveQuadratic()" class="calc-button mt-6" data-lang-key="solve_btn">Resolver</button><div id="quadraticResult" class="result-box"></div><button id="quadraticExplainBtn" onclick="explainQuadraticSteps()" class="calc-button gemini-button mt-4" style="display: none;" data-lang-key="explain_steps_btn">✨ Explicar os Passos</button><div id="quadraticExplainResult" class="result-box" style="display: none;"></div></div></div>
                <div id="tool-percentage" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="percentage_title" class="text-2xl font-semibold mb-4 text-center text-white">Calculadora de Porcentagem</h2><div><label for="percentage" class="font-medium" data-lang-key="percentage_label">Qual é a porcentagem?</label><div class="flex items-center mt-2"><input type="number" id="percentValue" class="input-field !w-1/3" placeholder="20"><span class="mx-2 text-gray-400" data-lang-key="percentage_of">de</span><input type="number" id="baseValue" class="input-field !w-2/3" placeholder="150"></div></div><button onclick="calculatePercentage()" class="calc-button mt-6" data-lang-key="calculate_btn">Calcular</button><div id="percentageResult" class="result-box text-center"></div></div></div>
                <div id="tool-temperature" class="tool-page calculator-card lg:col-span-3"><div class="tool-content-wrapper"><h2 data-lang-key="temperature_title" class="text-2xl font-semibold mb-4 text-center text-white">Conversor de Temperatura</h2><div><label for="celsius" class="font-medium">Celsius (°C)</label><input type="number" id="celsius" class="input-field" placeholder="Ex: 25" oninput="convertTemp('c_to_f')"></div><div class="mt-4"><label for="fahrenheit" class="font-medium">Fahrenheit (°F)</label><input type="number" id="fahrenheit" class="input-field" placeholder="Ex: 77" oninput="convertTemp('f_to_c')"></div><div class="result-box text-center" data-lang-key="real_time_conversion">As conversões são em tempo real.</div></div></div>

            </div>
        </div>
    </div>

    <script>
        // --- Language Translation System ---
        const translations = {
            'pt-br': {
                subtitle: "Suas ferramentas de IA para estudos, finanças e criatividade.",
                welcome_title: "Bem-vindo ao INFINITY MIND's",
                welcome_desc: "Sua central de ferramentas inteligentes para resolver desde problemas matemáticos complexos até cálculos do dia a dia. Explore nossas calculadoras e conversores, potencializados com IA para oferecer mais do que apenas respostas. Escolha uma ferramenta abaixo para começar.",
                
                tool_graph_plotter_title: "Gráfico de Funções", tool_graph_plotter_desc: "Visualize equações em um gráfico.",
                tool_mind_map_title: "Gerador de Mapas Mentais", tool_mind_map_desc: "Transforme assuntos em mapas visuais.",
                tool_formula_explainer_title: "Explicador de Fórmulas", tool_formula_explainer_desc: "Entenda qualquer fórmula matemática.",
                tool_solve_by_photo_title: "Resolver por Foto", tool_solve_by_photo_desc: "Envie a foto de um problema e a IA resolve.",
                tool_study_planner_title: "Planejador de Estudos", tool_study_planner_desc: "Crie um plano de estudos personalizado.",
                tool_image_gen_title: "Gerador de Imagens", tool_image_gen_desc: "Crie imagens a partir de texto com IA.",
                tool_live_chat_title: "Tutor IA ao Vivo", tool_live_chat_desc: "Tire suas dúvidas em tempo real.",
                tool_exercises_title: "Gerador de Exercícios", tool_exercises_desc: "Crie listas de exercícios personalizadas.",
                tool_financial_title: "Planejador Financeiro", tool_financial_desc: "Dicas de IA para suas finanças.",
                tool_word_problem_title: "Solucionador de Problemas", tool_word_problem_desc: "Deixe a IA resolver problemas para você.",
                tool_summarizer_title: "Resumo de Assuntos", tool_summarizer_desc: "Resumos de tópicos para estudantes.",
                tool_equations_title: "Sistemas de Equações", tool_equations_desc: "Resolva sistemas de 1º grau.",
                tool_currency_title: "Conversor de Moedas", tool_currency_desc: "Câmbio em tempo real.",
                tool_basic_calc_title: "Calculadora Básica", tool_basic_calc_desc: "Para cálculos rápidos.",
                tool_bmi_title: "Calculadora de IMC", tool_bmi_desc: "Monitore sua saúde.",
                tool_quadratic_title: "Equação Quadrática", tool_quadratic_desc: "Resolva equações de 2º grau.",
                tool_percentage_title: "Calculadora de Porcentagem", tool_percentage_desc: "Calcule porcentagens.",
                tool_temperature_title: "Conversor de Temperatura", tool_temperature_desc: "Celsius e Fahrenheit.",
                
                back_to_menu: "Voltar ao Menu",
                copied_to_clipboard: "Copiado!",

                graph_plotter_title: "✨ Gráfico de Funções", graph_plotter_desc: "Digite uma função de 'x' para visualizar seu gráfico.",
                function_label: "Função f(x) =", function_placeholder: "Ex: x^2, sin(x), 2*x + 1",
                x_min_label: "X Mínimo", x_max_label: "X Máximo", plot_graph_btn: "Gerar Gráfico",

                mind_map_title: "✨ Gerador de Mapas Mentais", mind_map_desc: "Digite um assunto para gerar um mapa mental visual e dinâmico.",
                mind_map_subject_label: "Assunto:", mind_map_placeholder: "Ex: Sistema Solar, Revolução Industrial",
                generate_mind_map_btn: "Gerar Mapa Mental",

                formula_explainer_title: "✨ Explicador de Fórmulas", formula_explainer_desc: "Digite o nome de uma fórmula matemática e a IA explicará para você.",
                formula_name_label: "Nome da Fórmula:", formula_placeholder: "Ex: Teorema de Pitágoras, Fórmula de Bhaskara",
                explain_btn: "Explicar Fórmula", listen_explanation_btn: "✨ Ouvir Explicação",

                solve_by_photo_title: "✨ Resolver Problema por Foto", solve_by_photo_desc: "Envie uma foto de um problema matemático e a IA irá resolvê-lo.",
                choose_image_btn: "Escolher Imagem", solve_photo_btn: "Resolver com IA",
                solve_by_photo_result_placeholder: "A solução para o problema na imagem aparecerá aqui.",
                no_image_selected: "Nenhuma imagem selecionada.",

                study_planner_title: "✨ Planejador de Estudos", study_planner_desc: "Crie um plano de estudos estruturado com a ajuda da IA.",
                study_subject_label: "Matéria:", study_subject_placeholder: "Ex: Álgebra Linear",
                study_duration_label: "Duração:", study_duration_placeholder: "Ex: 1 semana, 15 dias",
                generate_plan_btn: "Gerar Plano de Estudos",

                image_gen_title: "✨ Gerador de Imagens com IA", image_gen_desc: "Descreva a imagem que você quer criar.",
                image_prompt_label: "Descrição da Imagem:", image_gen_placeholder: "Ex: um astronauta surfando em um anel de saturno, arte digital",
                generate_image_btn: "Gerar Imagem", image_result_placeholder: "Sua imagem aparecerá aqui.", generating_image: "Gerando imagem...",

                live_chat_title: "💬 Tutor IA ao Vivo", live_chat_desc: "Faça uma pergunta e receba uma resposta instantânea.",
                chat_placeholder: "Digite sua pergunta...", send_btn: "Enviar",
                offensive_message_blocked: "Sua mensagem foi bloqueada por conter linguagem inadequada.",
                inappropriate_topic_refused: "Não posso responder a essa pergunta. Meu propósito é ajudar com tópicos educacionais de forma segura.",
                download_chat_btn: "Baixar Conversa", response_style_label: "Estilo da Resposta",
                style_objective: "Objetiva", style_detailed: "Detalhada",
                lockout_message_part1: "Você está bloqueado por uso de linguagem inadequada. Tempo restante:",
                lockout_level1_triggered: "Você foi bloqueado por 5 minutos.",
                lockout_level2_triggered: "Você foi bloqueado por 10 minutos.",
                lockout_level3_triggered: "Você foi bloqueado por 24 horas.",
                lockout_political: "Você foi bloqueado por 72 horas por discutir tópicos políticos inadequados.",
                
                financial_title: "💰 Planejador Financeiro com IA", financial_desc: "Receba dicas sobre investimentos e planejamento pessoal. (Isso não é um conselho financeiro real).",
                financial_query_label: "Sua meta ou dúvida:", financial_placeholder: "Ex: Como posso começar a economizar para comprar um carro?",
                get_advice_btn: "Obter Dicas",

                exercises_title: "✍️ Gerador de Exercícios", exercises_desc: "Crie exercícios sobre qualquer assunto.",
                subject_label: "Assunto:", subject_placeholder: "Ex: Revolução Industrial",
                question_count_label: "Nº de Questões", difficulty_label: "Nível",
                level_easy: "Fácil", level_medium: "Médio", level_hard: "Difícil",
                type_label: "Tipo", type_objective: "Objetivas", type_subjective: "Subjetivas", type_mixed: "Mistas",
                generate_exercises_btn: "Gerar Exercícios",
                
                equations_title: "🔢 Calculadora de Sistemas de Equações", equations_desc: "Resolva sistemas de equações lineares (1º grau) com duas incógnitas.",
                equations_no_solution: "O sistema não possui solução única.",

                word_problem_title: "✨ Solucionador de Problemas de Matemática", word_problem_desc: "Escreva um problema de matemática e deixe a IA resolvê-lo para você.",
                your_problem_label: "Seu problema:", word_problem_placeholder: "Ex: Maria tem 3 maçãs e João lhe dá mais 5. Com quantas maçãs Maria fica?",
                solve_problem_btn: "Resolver Problema", word_problem_result_placeholder: "A explicação passo a passo aparecerá aqui.",
                listen_solution_btn: "✨ Ouvir Solução",

                summarizer_title: "✨ Gerador de Resumos", summarizer_desc: "Digite um tópico e a IA criará um resumo ideal para estudantes até o 9º ano.",
                your_subject_label: "Qual é o assunto?", summarizer_placeholder: "Ex: Revolução Francesa, Fotossíntese, Teorema de Pitágoras",
                summarize_btn: "Resumir", summarizer_result_placeholder: "O resumo sobre o assunto aparecerá aqui.",
                listen_summary_btn: "✨ Ouvir Resumo",
                
                currency_title: "Conversor de Moedas", amount_label: "Valor", from_currency_label: "De", to_currency_label: "Para", convert_btn: "Converter",
                basic_calc_title: "Calculadora Básica", bmi_title: "Calculadora de IMC",
                weight_label: "Peso (kg)", height_label: "Altura (cm)", calculate_btn: "Calcular",
                get_tips_btn: "✨ Obter Dicas de Bem-Estar", quadratic_title: "Equação Quadrática",
                quadratic_desc: "Resolva: ax² + bx + c = 0", solve_btn: "Resolver", explain_steps_btn: "✨ Explicar os Passos",
                percentage_title: "Calculadora de Porcentagem", percentage_label: "Qual é a porcentagem?",
                percentage_of: "de", temperature_title: "Conversor de Temperatura", real_time_conversion: "As conversões são em tempo real.",
                thinking: "Pensando...", gemini_error: "Desculpe, não foi possível obter uma resposta da IA. Tente novamente mais tarde.",
                generating_response: "Gerando resposta com IA... Por favor, aguarde.",
                invalid_values: "Por favor, insira valores válidos.",
                missing_coeffs: "Por favor, insira todos os coeficientes.",
                coeff_a_zero: 'O coeficiente "a" não pode ser zero.',
                bmi_is: "Seu IMC é", classification: "Classificação",
                underweight: "Abaixo do peso", normal_weight: "Peso normal", overweight: "Sobrepeso", obesity: "Obesidade",
                two_real_roots: "Duas raízes reais", one_real_root: "Uma raiz real", complex_roots: "Raízes complexas",
                percentage_result_is: "é",
                currency_error: "Não foi possível obter as taxas de câmbio. Tente novamente.",
                conversion_result: "Resultado da Conversão",
            },
            'en': {
                subtitle: "Your AI tools for studies, finance, and creativity.",
                welcome_title: "Welcome to INFINITY MIND's",
                welcome_desc: "Your hub of smart tools to solve everything from complex math problems to daily calculations. Explore our calculators and converters, powered by AI to offer more than just answers. Choose a tool below to get started.",
                
                tool_graph_plotter_title: "Function Grapher", tool_graph_plotter_desc: "Visualize equations on a graph.",
                tool_mind_map_title: "Mind Map Generator", tool_mind_map_desc: "Turn subjects into visual maps.",
                tool_formula_explainer_title: "Formula Explainer", tool_formula_explainer_desc: "Understand any math formula.",
                tool_solve_by_photo_title: "Solve by Photo", tool_solve_by_photo_desc: "Upload a photo of a problem and AI will solve it.",
                tool_study_planner_title: "Study Planner", tool_study_planner_desc: "Create a custom study plan.",
                tool_image_gen_title: "Image Generator", tool_image_gen_desc: "Create images from text with AI.",
                tool_live_chat_title: "Live AI Tutor", tool_live_chat_desc: "Get your questions answered in real-time.",
                tool_exercises_title: "Exercise Generator", tool_exercises_desc: "Create custom exercise lists.",
                tool_financial_title: "Financial Planner", tool_financial_desc: "AI tips for your finances.",
                tool_word_problem_title: "Problem Solver", tool_word_problem_desc: "Let AI solve problems for you.",
                tool_summarizer_title: "Subject Summarizer", tool_summarizer_desc: "Summaries of topics for students.",
                tool_equations_title: "Systems of Equations", tool_equations_desc: "Solve 1st degree systems.",
                tool_currency_title: "Currency Converter", tool_currency_desc: "Real-time exchange.",
                tool_basic_calc_title: "Basic Calculator", tool_basic_calc_desc: "For quick calculations.",
                tool_bmi_title: "BMI Calculator", tool_bmi_desc: "Monitor your health.",
                tool_quadratic_title: "Quadratic Equation", tool_quadratic_desc: "Solve 2nd degree equations.",
                tool_percentage_title: "Percentage Calculator", tool_percentage_desc: "Calculate percentages.",
                tool_temperature_title: "Temperature Converter", tool_temperature_desc: "Celsius and Fahrenheit.",
                
                back_to_menu: "Back to Menu",
                copied_to_clipboard: "Copied!",

                graph_plotter_title: "✨ Function Grapher", graph_plotter_desc: "Enter a function of 'x' to visualize its graph.",
                function_label: "Function f(x) =", function_placeholder: "E.g., x^2, sin(x), 2*x + 1",
                x_min_label: "X Minimum", x_max_label: "X Maximum", plot_graph_btn: "Plot Graph",

                mind_map_title: "✨ Mind Map Generator", mind_map_desc: "Enter a subject to generate a dynamic visual mind map.",
                mind_map_subject_label: "Subject:", mind_map_placeholder: "E.g., Solar System, Industrial Revolution",
                generate_mind_map_btn: "Generate Mind Map",

                formula_explainer_title: "✨ Formula Explainer", formula_explainer_desc: "Enter the name of a mathematical formula and the AI will explain it to you.",
                formula_name_label: "Formula Name:", formula_placeholder: "E.g., Pythagorean Theorem, Quadratic Formula",
                explain_btn: "Explain Formula", listen_explanation_btn: "✨ Listen to Explanation",

                solve_by_photo_title: "✨ Solve Problem by Photo", solve_by_photo_desc: "Upload a photo of a math problem and the AI will solve it.",
                choose_image_btn: "Choose Image", solve_photo_btn: "Solve with AI",
                solve_by_photo_result_placeholder: "The solution to the problem in the image will appear here.",
                no_image_selected: "No image selected.",

                study_planner_title: "✨ Study Planner", study_planner_desc: "Create a structured study plan with the help of AI.",
                study_subject_label: "Subject:", study_subject_placeholder: "E.g., Linear Algebra",
                study_duration_label: "Duration:", study_duration_placeholder: "E.g., 1 week, 15 days",
                generate_plan_btn: "Generate Study Plan",

                image_gen_title: "✨ AI Image Generator", image_gen_desc: "Describe the image you want to create.",
                image_prompt_label: "Image Description:", image_gen_placeholder: "Ex: an astronaut surfing on a ring of saturn, digital art",
                generate_image_btn: "Generate Image", image_result_placeholder: "Your image will appear here.", generating_image: "Generating image...",

                live_chat_title: "💬 Live AI Tutor", live_chat_desc: "Ask a question and get an instant answer.",
                chat_placeholder: "Type your question...", send_btn: "Send",
                offensive_message_blocked: "Your message was blocked for containing inappropriate language.",
                inappropriate_topic_refused: "I cannot answer that question. My purpose is to help with educational topics safely.",
                download_chat_btn: "Download Chat", response_style_label: "Response Style",
                style_objective: "Objective", style_detailed: "Detailed",
                lockout_message_part1: "You are locked out for using inappropriate language. Time remaining:",
                lockout_level1_triggered: "You have been locked out for 5 minutes.",
                lockout_level2_triggered: "You have been locked out for 10 minutes.",
                lockout_level3_triggered: "You have been locked out for 24 hours.",
                lockout_political: "You have been locked out for 72 hours for discussing inappropriate political topics.",

                financial_title: "💰 AI Financial Planner", financial_desc: "Get tips on investments and personal planning. (This is not actual financial advice).",
                financial_query_label: "Your goal or question:", financial_placeholder: "Ex: How can I start saving to buy a car?",
                get_advice_btn: "Get Tips",

                exercises_title: "✍️ Exercise Generator", exercises_desc: "Create exercises on any subject.",
                subject_label: "Subject:", subject_placeholder: "Ex: Industrial Revolution",
                question_count_label: "No. of Questions", difficulty_label: "Level",
                level_easy: "Easy", level_medium: "Medium", level_hard: "Hard",
                type_label: "Type", type_objective: "Objective", type_subjective: "Subjective", type_mixed: "Mixed",
                generate_exercises_btn: "Generate Exercises",
                
                equations_title: "🔢 Systems of Equations Calculator", equations_desc: "Solve linear systems of equations (1st degree) with two variables.",
                equations_no_solution: "The system does not have a unique solution.",

                word_problem_title: "✨ Math Problem Solver", word_problem_desc: "Write a math problem and let the AI solve it for you.",
                your_problem_label: "Your problem:", word_problem_placeholder: "Ex: Mary has 3 apples and John gives her 5 more. How many apples does Mary have?",
                solve_problem_btn: "Solve Problem", word_problem_result_placeholder: "The step-by-step explanation will appear here.",
                listen_solution_btn: "✨ Listen to Solution",
                
                summarizer_title: "✨ Summary Generator", summarizer_desc: "Enter a topic and the AI will create a summary ideal for students up to the 9th grade.",
                your_subject_label: "What is the subject?", summarizer_placeholder: "Ex: French Revolution, Photosynthesis, Pythagorean Theorem",
                summarize_btn: "Summarize", summarizer_result_placeholder: "The summary of the subject will appear here.",
                listen_summary_btn: "✨ Listen to Summary",

                currency_title: "Currency Converter", amount_label: "Amount", from_currency_label: "From", to_currency_label: "To", convert_btn: "Convert",
                basic_calc_title: "Basic Calculator", bmi_title: "BMI Calculator",
                weight_label: "Weight (kg)", height_label: "Height (cm)", calculate_btn: "Calculate",
                get_tips_btn: "✨ Get Wellness Tips", quadratic_title: "Quadratic Equation",
                quadratic_desc: "Solve: ax² + bx + c = 0", solve_btn: "Solve", explain_steps_btn: "✨ Explain Steps",
                percentage_title: "Percentage Calculator", percentage_label: "What is the percentage?",
                percentage_of: "of", temperature_title: "Temperature Converter", real_time_conversion: "Conversions are in real-time.",
                thinking: "Thinking...", gemini_error: "Sorry, couldn't get a response from the AI. Please try again later.",
                generating_response: "Generating AI response... Please wait.",
                invalid_values: "Please enter valid values.",
                missing_coeffs: "Please enter all coefficients.",
                coeff_a_zero: 'Coefficient "a" cannot be zero.',
                bmi_is: "Your BMI is", classification: "Classification",
                underweight: "Underweight", normal_weight: "Normal weight", overweight: "Overweight", obesity: "Obesity",
                two_real_roots: "Two real roots", one_real_root: "One real root", complex_roots: "Complex roots",
                percentage_result_is: "is",
                currency_error: "Could not fetch exchange rates. Please try again.",
                conversion_result: "Conversion Result",
            },
            'es': {
                subtitle: "Tus herramientas de IA para estudios, finanzas y creatividad.",
                welcome_title: "Bienvenido a INFINITY MIND's",
                welcome_desc: "Tu centro de herramientas inteligentes para resolver desde problemas matemáticos complejos hasta cálculos diarios. Explora nuestras calculadoras y conversores, potenciados con IA para ofrecer más que solo respuestas. Elige una herramienta a continuación para comenzar.",
                
                tool_graph_plotter_title: "Graficador de Funciones", tool_graph_plotter_desc: "Visualiza ecuaciones en un gráfico.",
                tool_mind_map_title: "Generador de Mapas Mentales", tool_mind_map_desc: "Convierte temas en mapas visuales.",
                tool_formula_explainer_title: "Explicador de Fórmulas", tool_formula_explainer_desc: "Entiende cualquier fórmula matemática.",
                tool_solve_by_photo_title: "Resolver por Foto", tool_solve_by_photo_desc: "Sube la foto de un problema y la IA lo resolverá.",
                tool_study_planner_title: "Planificador de Estudios", tool_study_planner_desc: "Crea un plan de estudios personalizado.",
                tool_image_gen_title: "Generador de Imágenes", tool_image_gen_desc: "Crea imágenes a partir de texto con IA.",
                tool_live_chat_title: "Tutor de IA en Vivo", tool_live_chat_desc: "Obtén respuestas a tus preguntas en tiempo real.",
                tool_exercises_title: "Generador de Ejercicios", tool_exercises_desc: "Crea listas de ejercicios personalizadas.",
                tool_financial_title: "Planificador Financiero", tool_financial_desc: "Consejos de IA para tus finanzas.",
                tool_word_problem_title: "Solucionador de Problemas", tool_word_problem_desc: "Deja que la IA resuelva problemas por ti.",
                tool_summarizer_title: "Resumidor de Temas", tool_summarizer_desc: "Resúmenes de temas para estudiantes.",
                tool_equations_title: "Sistemas de Ecuaciones", tool_equations_desc: "Resuelve sistemas de 1er grado.",
                tool_currency_title: "Convertidor de Moneda", tool_currency_desc: "Cambio en tiempo real.",
                tool_basic_calc_title: "Calculadora Básica", tool_basic_calc_desc: "Para cálculos rápidos.",
                tool_bmi_title: "Calculadora de IMC", tool_bmi_desc: "Monitorea tu salud.",
                tool_quadratic_title: "Ecuación Cuadrática", tool_quadratic_desc: "Resuelve ecuaciones de 2º grado.",
                tool_percentage_title: "Calculadora de Porcentaje", tool_percentage_desc: "Calcula porcentajes.",
                tool_temperature_title: "Convertidor de Temperatura", tool_temperature_desc: "Celsius y Fahrenheit.",
                
                back_to_menu: "Volver al Menú",
                copied_to_clipboard: "¡Copiado!",

                graph_plotter_title: "✨ Graficador de Funciones", graph_plotter_desc: "Introduce una función de 'x' para visualizar su gráfico.",
                function_label: "Función f(x) =", function_placeholder: "Ej: x^2, sin(x), 2*x + 1",
                x_min_label: "X Mínimo", x_max_label: "X Máximo", plot_graph_btn: "Generar Gráfico",

                mind_map_title: "✨ Generador de Mapas Mentales", mind_map_desc: "Introduce un tema para generar un mapa mental visual y dinámico.",
                mind_map_subject_label: "Tema:", mind_map_placeholder: "Ej: Sistema Solar, Revolución Industrial",
                generate_mind_map_btn: "Generar Mapa Mental",

                formula_explainer_title: "✨ Explicador de Fórmulas", formula_explainer_desc: "Introduce el nombre de una fórmula matemática y la IA te la explicará.",
                formula_name_label: "Nombre de la Fórmula:", formula_placeholder: "Ej: Teorema de Pitágoras, Fórmula Cuadrática",
                explain_btn: "Explicar Fórmula", listen_explanation_btn: "✨ Escuchar Explicación",

                solve_by_photo_title: "✨ Resolver Problema por Foto", solve_by_photo_desc: "Sube una foto de un problema matemático y la IA lo resolverá.",
                choose_image_btn: "Elegir Imagen", solve_photo_btn: "Resolver con IA",
                solve_by_photo_result_placeholder: "La solución al problema en la imagen aparecerá aquí.",
                no_image_selected: "No se ha seleccionado ninguna imagen.",

                study_planner_title: "✨ Planificador de Estudios", study_planner_desc: "Crea un plan de estudios estructurado con la ayuda de la IA.",
                study_subject_label: "Materia:", study_subject_placeholder: "Ej: Álgebra Lineal",
                study_duration_label: "Duración:", study_duration_placeholder: "Ej: 1 semana, 15 días",
                generate_plan_btn: "Generar Plan de Estudios",

                image_gen_title: "✨ Generador de Imágenes con IA", image_gen_desc: "Describe la imagen que quieres crear.",
                image_prompt_label: "Descripción de la Imagen:", image_gen_placeholder: "Ej: un astronauta surfeando en un anillo de saturno, arte digital",
                generate_image_btn: "Generar Imagen", image_result_placeholder: "Tu imagen aparecerá aquí.", generating_image: "Generando imagen...",

                live_chat_title: "💬 Tutor de IA en Vivo", live_chat_desc: "Haz una pregunta y recibe una respuesta instantánea.",
                chat_placeholder: "Escribe tu pregunta...", send_btn: "Enviar",
                offensive_message_blocked: "Tu mensaje fue bloqueado por contener lenguaje inapropiado.",
                inappropriate_topic_refused: "No puedo responder a esa pregunta. Mi propósito es ayudar con temas educativos de forma segura.",
                download_chat_btn: "Descargar Conversación", response_style_label: "Estilo de Respuesta",
                style_objective: "Objetiva", style_detailed: "Detallada",
                lockout_message_part1: "Estás bloqueado por usar lenguaje inapropiado. Tiempo restante:",
                lockout_level1_triggered: "Has sido bloqueado por 5 minutos.",
                lockout_level2_triggered: "Has sido bloqueado por 10 minutos.",
                lockout_level3_triggered: "Has sido bloqueado por 24 horas.",
                lockout_political: "Has sido bloqueado por 72 horas por discutir temas políticos inapropiados.",

                financial_title: "💰 Planificador Financiero con IA", financial_desc: "Recibe consejos sobre inversiones y planificación personal. (Esto no es un consejo financiero real).",
                financial_query_label: "Tu meta o duda:", financial_placeholder: "Ej: ¿Cómo puedo empezar a ahorrar para comprar un coche?",
                get_advice_btn: "Obtener Consejos",

                exercises_title: "✍️ Generador de Ejercicios", exercises_desc: "Crea ejercicios sobre cualquier tema.",
                subject_label: "Tema:", subject_placeholder: "Ej: Revolución Industrial",
                question_count_label: "Nº de Preguntas", difficulty_label: "Nivel",
                level_easy: "Fácil", level_medium: "Medio", level_hard: "Difícil",
                type_label: "Tipo", type_objective: "Objetivas", type_subjective: "Subjetivas", type_mixed: "Mixtas",
                generate_exercises_btn: "Generar Ejercicios",
                
                equations_title: "🔢 Calculadora de Sistemas de Ecuaciones", equations_desc: "Resuelve sistemas de ecuaciones lineales (1er grado) con dos incógnitas.",
                equations_no_solution: "El sistema no tiene una solución única.",

                word_problem_title: "✨ Solucionador de Problemas de Matemáticas", word_problem_desc: "Escribe un problema matemático y deja que la IA lo resuelva por ti.",
                your_problem_label: "Tu problema:", word_problem_placeholder: "Ej: María tiene 3 manzanas y Juan le da 5 más. ¿Cuántas manzanas tiene María?",
                solve_problem_btn: "Resolver Problema", word_problem_result_placeholder: "La explicación paso a paso aparecerá aquí.",
                listen_solution_btn: "✨ Escuchar Solución",

                summarizer_title: "✨ Generador de Resúmenes", summarizer_desc: "Introduce un tema y la IA creará un resumen ideal para estudiantes.",
                your_subject_label: "¿Cuál es el tema?", summarizer_placeholder: "Ej: Revolución Francesa, Fotosíntesis, Teorema de Pitágoras",
                summarize_btn: "Resumir", summarizer_result_placeholder: "El resumen sobre el tema aparecerá aquí.",
                listen_summary_btn: "✨ Escuchar Resumen",
                
                currency_title: "Convertidor de Moneda", amount_label: "Cantidad", from_currency_label: "De", to_currency_label: "A", convert_btn: "Convertir",
                basic_calc_title: "Calculadora Básica", bmi_title: "Calculadora de IMC",
                weight_label: "Peso (kg)", height_label: "Altura (cm)", calculate_btn: "Calcular",
                get_tips_btn: "✨ Obtener Consejos de Bienestar", quadratic_title: "Ecuación Cuadrática",
                quadratic_desc: "Resuelve: ax² + bx + c = 0", solve_btn: "Resolver", explain_steps_btn: "✨ Explicar los Pasos",
                percentage_title: "Calculadora de Porcentaje", percentage_label: "¿Cuál es el porcentaje?",
                percentage_of: "de", temperature_title: "Convertidor de Temperatura", real_time_conversion: "Las conversiones son en tiempo real.",
                thinking: "Pensando...", gemini_error: "Lo siento, no se pudo obtener una respuesta de la IA. Por favor, inténtalo de nuevo más tarde.",
                generating_response: "Generando respuesta con IA... Por favor, espera.",
                invalid_values: "Por favor, introduce valores válidos.",
                missing_coeffs: "Por favor, introduce todos los coeficientes.",
                coeff_a_zero: 'El coeficiente "a" no puede ser cero.',
                bmi_is: "Tu IMC es", classification: "Clasificación",
                underweight: "Bajo peso", normal_weight: "Peso normal", overweight: "Sobrepeso", obesity: "Obesidad",
                two_real_roots: "Dos raíces reales", one_real_root: "Una raíz real", complex_roots: "Raíces complejas",
                percentage_result_is: "es",
                currency_error: "No se pudieron obtener las tasas de cambio. Inténtalo de nuevo.",
                conversion_result: "Resultado de la Conversión",
            },
            'it': {
                subtitle: "I tuoi strumenti di IA per studio, finanza e creatività.",
                welcome_title: "Benvenuto su INFINITY MIND's",
                welcome_desc: "Il tuo hub di strumenti intelligenti per risolvere dai complessi problemi di matematica ai calcoli quotidiani. Esplora le nostre calcolatrici e convertitori, potenziati con l'IA per offrire più di semplici risposte. Scegli uno strumento qui sotto per iniziare.",
                
                tool_graph_plotter_title: "Grafico di Funzioni", tool_graph_plotter_desc: "Visualizza equazioni su un grafico.",
                tool_mind_map_title: "Generatore di Mappe Mentali", tool_mind_map_desc: "Trasforma argomenti in mappe visive.",
                tool_formula_explainer_title: "Spiegazione Formule", tool_formula_explainer_desc: "Comprendi qualsiasi formula matematica.",
                tool_solve_by_photo_title: "Risolvi da Foto", tool_solve_by_photo_desc: "Carica la foto di un problema e l'IA lo risolverà.",
                tool_study_planner_title: "Pianificatore di Studio", tool_study_planner_desc: "Crea un piano di studio personalizzato.",
                tool_image_gen_title: "Generatore di Immagini", tool_image_gen_desc: "Crea immagini da testo con l'IA.",
                tool_live_chat_title: "Tutor IA dal Vivo", tool_live_chat_desc: "Ottieni risposte alle tue domande in tempo reale.",
                tool_exercises_title: "Generatore di Esercizi", tool_exercises_desc: "Crea elenchi di esercizi personalizzati.",
                tool_financial_title: "Pianificatore Finanziario", tool_financial_desc: "Consigli dall'IA per le tue finanze.",
                tool_word_problem_title: "Risolutore di Problemi", tool_word_problem_desc: "Lascia che l'IA risolva i problemi per te.",
                tool_summarizer_title: "Riassunto di Argomenti", tool_summarizer_desc: "Riassunti di argomenti per studenti.",
                tool_equations_title: "Sistemi di Equazioni", tool_equations_desc: "Risolvi sistemi di 1° grado.",
                tool_currency_title: "Convertitore di Valuta", tool_currency_desc: "Cambio in tempo reale.",
                tool_basic_calc_title: "Calcolatrice di Base", tool_basic_calc_desc: "Per calcoli veloci.",
                tool_bmi_title: "Calcolatrice IMC", tool_bmi_desc: "Monitora la tua salute.",
                tool_quadratic_title: "Equazione Quadratica", tool_quadratic_desc: "Risolvi equazioni di 2° grado.",
                tool_percentage_title: "Calcolatrice Percentuale", tool_percentage_desc: "Calcola percentuali.",
                tool_temperature_title: "Convertitore di Temperatura", tool_temperature_desc: "Celsius e Fahrenheit.",

                back_to_menu: "Torna al Menu",
                copied_to_clipboard: "Copiato!",

                graph_plotter_title: "✨ Grafico di Funzioni", graph_plotter_desc: "Inserisci una funzione di 'x' per visualizzare il suo grafico.",
                function_label: "Funzione f(x) =", function_placeholder: "Es: x^2, sin(x), 2*x + 1",
                x_min_label: "X Minimo", x_max_label: "X Massimo", plot_graph_btn: "Genera Grafico",

                mind_map_title: "✨ Generatore di Mappe Mentali", mind_map_desc: "Inserisci un argomento per generare una mappa mentale visiva e dinamica.",
                mind_map_subject_label: "Argomento:", mind_map_placeholder: "Es: Sistema Solare, Rivoluzione Industriale",
                generate_mind_map_btn: "Genera Mappa Mentale",

                formula_explainer_title: "✨ Spiegazione Formule", formula_explainer_desc: "Inserisci il nome di una formula matematica e l'IA te la spiegherà.",
                formula_name_label: "Nome della Formula:", formula_placeholder: "Es: Teorema di Pitagora, Formula Quadratica",
                explain_btn: "Spiega Formula", listen_explanation_btn: "✨ Ascolta la Spiegazione",

                solve_by_photo_title: "✨ Risolvi Problema da Foto", solve_by_photo_desc: "Carica una foto di un problema di matematica e l'IA lo risolverà.",
                choose_image_btn: "Scegli Immagine", solve_photo_btn: "Risolvi con IA",
                solve_by_photo_result_placeholder: "La soluzione al problema nell'immagine apparirà qui.",
                no_image_selected: "Nessuna immagine selezionata.",

                study_planner_title: "✨ Pianificatore di Studio", study_planner_desc: "Crea un piano di studio strutturato con l'aiuto dell'IA.",
                study_subject_label: "Materia:", study_subject_placeholder: "Es: Algebra Lineare",
                study_duration_label: "Durata:", study_duration_placeholder: "Es: 1 settimana, 15 giorni",
                generate_plan_btn: "Genera Piano di Studio",

                image_gen_title: "✨ Generatore di Immagini IA", image_gen_desc: "Descrivi l'immagine che vuoi creare.",
                image_prompt_label: "Descrizione dell'Immagine:", image_gen_placeholder: "Es: un astronauta che fa surf su un anello di saturno, arte digitale",
                generate_image_btn: "Genera Immagine", image_result_placeholder: "La tua immagine apparirà qui.", generating_image: "Generazione immagine in corso...",

                live_chat_title: "💬 Tutor IA dal Vivo", live_chat_desc: "Fai una domanda e ricevi una risposta immediata.",
                chat_placeholder: "Scrivi la tua domanda...", send_btn: "Invia",
                offensive_message_blocked: "Il tuo messaggio è stato bloccato perché contiene linguaggio inappropriato.",
                inappropriate_topic_refused: "Non posso rispondere a questa domanda. Il mio scopo è aiutare con argomenti educativi in modo sicuro.",
                download_chat_btn: "Scarica Conversazione", response_style_label: "Stile Risposta",
                style_objective: "Obiettiva", style_detailed: "Dettagliata",
                lockout_message_part1: "Sei stato bloccato per uso di linguaggio inappropriato. Tempo rimanente:",
                lockout_level1_triggered: "Sei stato bloccato per 5 minuti.",
                lockout_level2_triggered: "Sei stato bloccato per 10 minuti.",
                lockout_level3_triggered: "Sei stato bloccato per 24 ore.",
                lockout_political: "Sei stato bloccato per 72 ore per aver discusso di argomenti politici inappropriati.",

                financial_title: "💰 Pianificatore Finanziario IA", financial_desc: "Ricevi consigli su investimenti e pianificazione personale. (Questo non è un consiglio finanziario reale).",
                financial_query_label: "Il tuo obiettivo o domanda:", financial_placeholder: "Es: Come posso iniziare a risparmiare per comprare un'auto?",
                get_advice_btn: "Ottieni Consigli",

                exercises_title: "✍️ Generatore di Esercizi", exercises_desc: "Crea esercizi su qualsiasi argomento.",
                subject_label: "Argomento:", subject_placeholder: "Es: Rivoluzione Industriale",
                question_count_label: "N. di Domande", difficulty_label: "Livello",
                level_easy: "Facile", level_medium: "Medio", level_hard: "Difficile",
                type_label: "Tipo", type_objective: "A scelta multipla", type_subjective: "Aperte", type_mixed: "Miste",
                generate_exercises_btn: "Genera Esercizi",

                equations_title: "🔢 Calcolatrice di Sistemi di Equazioni", equations_desc: "Risolvi sistemi di equazioni lineari (1° grado) a due incognite.",
                equations_no_solution: "Il sistema non ha una soluzione unica.",

                word_problem_title: "✨ Risolutore di Problemi di Matematica", word_problem_desc: "Scrivi un problema di matematica e lascia che l'IA lo risolva per te.",
                your_problem_label: "Il tuo problema:", word_problem_placeholder: "Es: Maria ha 3 mele e Giovanni gliene dà altre 5. Quante mele ha Maria?",
                solve_problem_btn: "Risolvi Problema", word_problem_result_placeholder: "La spiegazione passo passo apparirà qui.",
                listen_solution_btn: "✨ Ascolta la Soluzione",

                summarizer_title: "✨ Generatore di Riassunti", summarizer_desc: "Inserisci un argomento e l'IA creerà un riassunto ideale per gli studenti.",
                your_subject_label: "Qual è l'argomento?", summarizer_placeholder: "Es: Rivoluzione Francese, Fotosintesi, Teorema di Pitagora",
                summarize_btn: "Riassumi", summarizer_result_placeholder: "Il riassunto dell'argomento apparirà qui.",
                listen_summary_btn: "✨ Ascolta il Riassunto",

                currency_title: "Convertitore di Valuta", amount_label: "Importo", from_currency_label: "Da", to_currency_label: "A", convert_btn: "Converti",
                basic_calc_title: "Calcolatrice di Base", bmi_title: "Calcolatrice IMC",
                weight_label: "Peso (kg)", height_label: "Altezza (cm)", calculate_btn: "Calcola",
                get_tips_btn: "✨ Ottieni Consigli Benessere", quadratic_title: "Equazione Quadratica",
                quadratic_desc: "Risolvi: ax² + bx + c = 0", solve_btn: "Risolvi", explain_steps_btn: "✨ Spiega i Passaggi",
                percentage_title: "Calcolatrice Percentuale", percentage_label: "Qual è la percentuale?",
                percentage_of: "di", temperature_title: "Convertitore di Temperatura", real_time_conversion: "Le conversioni sono in tempo reale.",
                thinking: "Sto pensando...", gemini_error: "Spiacenti, non è stato possibile ottenere una risposta dall'IA. Riprova più tardi.",
                generating_response: "Generazione risposta IA in corso... Attendere prego.",
                invalid_values: "Inserisci valori validi.",
                missing_coeffs: "Inserisci tutti i coefficienti.",
                coeff_a_zero: 'Il coefficiente "a" non può essere zero.',
                bmi_is: "Il tuo IMC è", classification: "Classificazione",
                underweight: "Sottopeso", normal_weight: "Normopeso", overweight: "Sovrappeso", obesity: "Obesità",
                two_real_roots: "Due radici reali", one_real_root: "Una radice reale", complex_roots: "Radici complesse",
                percentage_result_is: "è",
                currency_error: "Impossibile recuperare i tassi di cambio. Riprova.",
                conversion_result: "Risultato Conversione",
            },
            'de': {
                subtitle: "Ihre KI-Tools für Studium, Finanzen und Kreativität.",
                welcome_title: "Willkommen bei INFINITY MIND's",
                welcome_desc: "Ihr Zentrum für intelligente Werkzeuge, um alles von komplexen mathematischen Problemen bis hin zu alltäglichen Berechnungen zu lösen. Entdecken Sie unsere Rechner und Konverter, die mit KI ausgestattet sind, um mehr als nur Antworten zu bieten. Wählen Sie unten ein Werkzeug aus, um zu beginnen.",
                
                tool_graph_plotter_title: "Funktionsgrapher", tool_graph_plotter_desc: "Visualisieren Sie Gleichungen in einem Graphen.",
                tool_mind_map_title: "Mind-Map-Generator", tool_mind_map_desc: "Verwandeln Sie Themen in visuelle Karten.",
                tool_formula_explainer_title: "Formelerklärer", tool_formula_explainer_desc: "Verstehen Sie jede mathematische Formel.",
                tool_solve_by_photo_title: "Per Foto lösen", tool_solve_by_photo_desc: "Laden Sie ein Foto eines Problems hoch und die KI wird es lösen.",
                tool_study_planner_title: "Studienplaner", tool_study_planner_desc: "Erstellen Sie einen individuellen Lernplan.",
                tool_image_gen_title: "Bildgenerator", tool_image_gen_desc: "Erstellen Sie Bilder aus Text mit KI.",
                tool_live_chat_title: "Live-KI-Tutor", tool_live_chat_desc: "Erhalten Sie Antworten auf Ihre Fragen in Echtzeit.",
                tool_exercises_title: "Übungsgenerator", tool_exercises_desc: "Erstellen Sie benutzerdefinierte Übungslisten.",
                tool_financial_title: "Finanzplaner", tool_financial_desc: "KI-Tipps für Ihre Finanzen.",
                tool_word_problem_title: "Problemlöser", tool_word_problem_desc: "Lassen Sie die KI Probleme für Sie lösen.",
                tool_summarizer_title: "Themen-Zusammenfassung", tool_summarizer_desc: "Zusammenfassungen von Themen für Schüler.",
                tool_equations_title: "Gleichungssysteme", tool_equations_desc: "Lösen Sie Systeme 1. Grades.",
                tool_currency_title: "Währungsrechner", tool_currency_desc: "Echtzeit-Wechselkurse.",
                tool_basic_calc_title: "Basis-Taschenrechner", tool_basic_calc_desc: "Für schnelle Berechnungen.",
                tool_bmi_title: "BMI-Rechner", tool_bmi_desc: "Überwachen Sie Ihre Gesundheit.",
                tool_quadratic_title: "Quadratische Gleichung", tool_quadratic_desc: "Lösen Sie Gleichungen 2. Grades.",
                tool_percentage_title: "Prozentrechner", tool_percentage_desc: "Berechnen Sie Prozentsätze.",
                tool_temperature_title: "Temperaturumrechner", tool_temperature_desc: "Celsius und Fahrenheit.",

                back_to_menu: "Zurück zum Menü",
                copied_to_clipboard: "Kopiert!",

                graph_plotter_title: "✨ Funktionsgrapher", graph_plotter_desc: "Geben Sie eine Funktion von 'x' ein, um deren Graphen zu visualisieren.",
                function_label: "Funktion f(x) =", function_placeholder: "Z.B.: x^2, sin(x), 2*x + 1",
                x_min_label: "X Minimum", x_max_label: "X Maximum", plot_graph_btn: "Graph zeichnen",

                mind_map_title: "✨ Mind-Map-Generator", mind_map_desc: "Geben Sie ein Thema ein, um eine dynamische visuelle Mind-Map zu erstellen.",
                mind_map_subject_label: "Thema:", mind_map_placeholder: "Z.B.: Sonnensystem, Industrielle Revolution",
                generate_mind_map_btn: "Mind-Map erstellen",

                formula_explainer_title: "✨ Formelerklärer", formula_explainer_desc: "Geben Sie den Namen einer mathematischen Formel ein und die KI wird sie Ihnen erklären.",
                formula_name_label: "Name der Formel:", formula_placeholder: "Z.B.: Satz des Pythagoras, Quadratische Formel",
                explain_btn: "Formel erklären", listen_explanation_btn: "✨ Erklärung anhören",

                solve_by_photo_title: "✨ Problem per Foto lösen", solve_by_photo_desc: "Laden Sie ein Foto eines mathematischen Problems hoch und die KI wird es lösen.",
                choose_image_btn: "Bild auswählen", solve_photo_btn: "Mit KI lösen",
                solve_by_photo_result_placeholder: "Die Lösung für das Problem im Bild wird hier angezeigt.",
                no_image_selected: "Kein Bild ausgewählt.",

                study_planner_title: "✨ Studienplaner", study_planner_desc: "Erstellen Sie einen strukturierten Lernplan mit Hilfe von KI.",
                study_subject_label: "Fach:", study_subject_placeholder: "Z.B.: Lineare Algebra",
                study_duration_label: "Dauer:", study_duration_placeholder: "Z.B.: 1 Woche, 15 Tage",
                generate_plan_btn: "Lernplan erstellen",

                image_gen_title: "✨ KI-Bildgenerator", image_gen_desc: "Beschreiben Sie das Bild, das Sie erstellen möchten.",
                image_prompt_label: "Bildbeschreibung:", image_gen_placeholder: "Z.B.: ein Astronaut, der auf einem Saturnring surft, digitale Kunst",
                generate_image_btn: "Bild erstellen", image_result_placeholder: "Ihr Bild wird hier angezeigt.", generating_image: "Bild wird erstellt...",

                live_chat_title: "💬 Live-KI-Tutor", live_chat_desc: "Stellen Sie eine Frage und erhalten Sie eine sofortige Antwort.",
                chat_placeholder: "Geben Sie Ihre Frage ein...", send_btn: "Senden",
                offensive_message_blocked: "Ihre Nachricht wurde wegen unangemessener Sprache blockiert.",
                inappropriate_topic_refused: "Ich kann diese Frage nicht beantworten. Mein Zweck ist es, bei Bildungsthemen sicher zu helfen.",
                download_chat_btn: "Chat herunterladen", response_style_label: "Antwortstil",
                style_objective: "Objektiv", style_detailed: "Detailliert",
                lockout_message_part1: "Sie sind wegen unangemessener Sprache gesperrt. Verbleibende Zeit:",
                lockout_level1_triggered: "Sie wurden für 5 Minuten gesperrt.",
                lockout_level2_triggered: "Sie wurden für 10 Minuten gesperrt.",
                lockout_level3_triggered: "Sie wurden für 24 Stunden gesperrt.",
                lockout_political: "Sie wurden für 72 Stunden gesperrt, weil Sie unangemessene politische Themen diskutiert haben.",

                financial_title: "💰 KI-Finanzplaner", financial_desc: "Erhalten Sie Tipps zu Investitionen und persönlicher Planung. (Dies ist keine echte Finanzberatung).",
                financial_query_label: "Ihr Ziel oder Ihre Frage:", financial_placeholder: "Z.B.: Wie kann ich anfangen, für ein Auto zu sparen?",
                get_advice_btn: "Tipps erhalten",

                exercises_title: "✍️ Übungsgenerator", exercises_desc: "Erstellen Sie Übungen zu jedem Thema.",
                subject_label: "Thema:", subject_placeholder: "Z.B.: Industrielle Revolution",
                question_count_label: "Anzahl der Fragen", difficulty_label: "Niveau",
                level_easy: "Leicht", level_medium: "Mittel", level_hard: "Schwer",
                type_label: "Typ", type_objective: "Multiple-Choice", type_subjective: "Offen", type_mixed: "Gemischt",
                generate_exercises_btn: "Übungen erstellen",

                equations_title: "🔢 Rechner für Gleichungssysteme", equations_desc: "Lösen Sie lineare Gleichungssysteme (1. Grad) mit zwei Unbekannten.",
                equations_no_solution: "Das System hat keine eindeutige Lösung.",

                word_problem_title: "✨ Mathe-Problemlöser", word_problem_desc: "Schreiben Sie ein mathematisches Problem auf und lassen Sie es von der KI lösen.",
                your_problem_label: "Ihr Problem:", word_problem_placeholder: "Z.B.: Maria hat 3 Äpfel und Johannes gibt ihr 5 weitere. Wie viele Äpfel hat Maria?",
                solve_problem_btn: "Problem lösen", word_problem_result_placeholder: "Die Schritt-für-Schritt-Erklärung wird hier angezeigt.",
                listen_solution_btn: "✨ Lösung anhören",

                summarizer_title: "✨ Zusammenfassungs-Generator", summarizer_desc: "Geben Sie ein Thema ein und die KI erstellt eine ideale Zusammenfassung für Schüler.",
                your_subject_label: "Was ist das Thema?", summarizer_placeholder: "Z.B.: Französische Revolution, Photosynthese, Satz des Pythagoras",
                summarize_btn: "Zusammenfassen", summarizer_result_placeholder: "Die Zusammenfassung des Themas wird hier angezeigt.",
                listen_summary_btn: "✨ Zusammenfassung anhören",

                currency_title: "Währungsrechner", amount_label: "Betrag", from_currency_label: "Von", to_currency_label: "Nach", convert_btn: "Umrechnen",
                basic_calc_title: "Basis-Taschenrechner", bmi_title: "BMI-Rechner",
                weight_label: "Gewicht (kg)", height_label: "Größe (cm)", calculate_btn: "Berechnen",
                get_tips_btn: "✨ Wellness-Tipps erhalten", quadratic_title: "Quadratische Gleichung",
                quadratic_desc: "Lösen Sie: ax² + bx + c = 0", solve_btn: "Lösen", explain_steps_btn: "✨ Schritte erklären",
                percentage_title: "Prozentrechner", percentage_label: "Was ist der Prozentsatz?",
                percentage_of: "von", temperature_title: "Temperaturumrechner", real_time_conversion: "Die Umrechnungen erfolgen in Echtzeit.",
                thinking: "Denke nach...", gemini_error: "Entschuldigung, es konnte keine Antwort von der KI abgerufen werden. Bitte versuchen Sie es später erneut.",
                generating_response: "KI-Antwort wird generiert... Bitte warten.",
                invalid_values: "Bitte geben Sie gültige Werte ein.",
                missing_coeffs: "Bitte geben Sie alle Koeffizienten ein.",
                coeff_a_zero: 'Der Koeffizient "a" darf nicht null sein.',
                bmi_is: "Ihr BMI ist", classification: "Klassifizierung",
                underweight: "Untergewicht", normal_weight: "Normalgewicht", overweight: "Übergewicht", obesity: "Fettleibigkeit",
                two_real_roots: "Zwei reelle Wurzeln", one_real_root: "Eine reelle Wurzel", complex_roots: "Komplexe Wurzeln",
                percentage_result_is: "ist",
                currency_error: "Wechselkurse konnten nicht abgerufen werden. Bitte versuchen Sie es erneut.",
                conversion_result: "Umrechnungsergebnis",
            },
        };

        let currentLang = 'pt-br';
        function changeLanguage(lang) {
            currentLang = lang;
            document.getElementById('html-lang').lang = lang.split('-')[0];
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.getAttribute('data-lang-key');
                const translation = (translations[lang] || translations['en'])[key];
                if (translation) {
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = translation;
                    } else {
                        el.innerHTML = translation;
                    }
                }
            });
        }
        
        // --- Navigation ---
        const homePage = document.getElementById('home-page');
        const toolsContainer = document.getElementById('tools-container');
        const toolPages = document.querySelectorAll('.tool-page');

        function showTool(toolId) {
            homePage.style.display = 'none';
            toolPages.forEach(page => page.style.display = 'none');
            document.getElementById(toolId).style.display = 'flex';
            toolsContainer.style.display = 'block';
            if (toolId === 'tool-live-chat') {
                checkInitialLockout();
            }
        }

        function showHome() {
            toolsContainer.style.display = 'none';
            homePage.style.display = 'block';
            document.querySelectorAll('.menu-card').forEach((card, index) => {
                card.style.animationDelay = `${index * 50}ms`;
            });
        }

        let lastBmiData = {};
        let lastQuadraticData = {};
        let currentImageBase64 = null;
        let chartInstance = null;
        let toastTimeout;


        function animateResultBox(element) {
            element.classList.remove('fade-in');
            void element.offsetWidth; 
            element.classList.add('fade-in');
        }

        // --- NEW: Toast Notification ---
        function showToast(message) {
            const toast = document.getElementById('toast');
            if (!toast) return;
            toast.textContent = message;
            toast.className = 'show';
            clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => {
                toast.className = toast.className.replace('show', 'hide');
            }, 2000);
        }

        // --- NEW: Copy to Clipboard ---
        function copyToClipboard(text) {
            if (!text) return;
            // Use a temporary textarea to preserve formatting
            const tempTextarea = document.createElement('textarea');
            // Convert <br> tags back to newlines for clipboard
            tempTextarea.value = text.replace(/<br\s*\/?>/gi, '\n');
            document.body.appendChild(tempTextarea);
            tempTextarea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextarea);
            showToast(translations[currentLang].copied_to_clipboard || "Copied!");
        }

        // --- NEW: Function to add copy button ---
        function addCopyButton(resultDiv) {
            if (!resultDiv) return;
            // Remove any existing copy button
            const existingBtn = resultDiv.querySelector('.copy-btn');
            if (existingBtn) {
                existingBtn.remove();
            }

            const copyButton = document.createElement('button');
            copyButton.className = 'copy-btn';
            copyButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zM-1 7a.5.5 0 0 1 .5-.5h15a.5.5 0 0 1 0 1H-.5A.5.5 0 0 1-1 7z"/></svg>`;

            copyButton.onclick = (e) => {
                e.stopPropagation();
                copyToClipboard(resultDiv.innerHTML);
            };

            resultDiv.appendChild(copyButton);
        }

        // --- Gemini API Call (Text) ---
        async function callGemini(prompt, button, resultDiv, audioContainerId) {
            if (audioContainerId) {
                document.getElementById(audioContainerId).innerHTML = ''; // Clear old audio player
            }
            if (!button || !resultDiv) {
                console.error("Button or resultDiv is null.", { button, resultDiv });
                return;
            }
            const originalButtonText = button.innerHTML;
            button.disabled = true;
            button.innerHTML = `<span class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>`;
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = translations[currentLang].generating_response;
            animateResultBox(resultDiv);

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };
            
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error('API response not OK');
                
                const result = await response.json();
                const candidate = result.candidates?.[0];
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    let text = candidate.content.parts[0].text;
                    resultDiv.dataset.rawText = text; // Store raw text for TTS
                    
                    text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                    text = text.replace(/\* (.*?)/g, '&bull; $1'); 
                    text = text.replace(/(\r\n|\n|\r)/g, "<br>"); 
                    text = text.replace(/<br>\s*<br>/g, '<br>');
                    resultDiv.innerHTML = text;
                    addCopyButton(resultDiv); // Add copy button to the result
                    
                    if(audioContainerId) {
                        const listenButton = document.createElement('button');
                        let buttonTextKey = 'listen_solution_btn'; // Default
                        if(audioContainerId === 'summarizerAudioPlayerContainer') buttonTextKey = 'listen_summary_btn';
                        if(audioContainerId === 'formulaAudioPlayerContainer') buttonTextKey = 'listen_explanation_btn';
                        
                        listenButton.innerHTML = translations[currentLang][buttonTextKey] || 'Listen';
                        listenButton.className = 'calc-button gemini-button mt-4';
                        listenButton.onclick = () => playTextAsSpeech(resultDiv.dataset.rawText, audioContainerId, listenButton);
                        document.getElementById(audioContainerId).appendChild(listenButton);
                    }
                } else {
                    throw new Error('Invalid response structure');
                }
            } catch (error) {
                console.error('API call failed:', error);
                resultDiv.innerHTML = translations[currentLang].gemini_error;
            } finally {
                animateResultBox(resultDiv);
                button.disabled = false;
                button.innerHTML = originalButtonText;
            }
        }
        
        // --- TTS (Text-to-Speech) Functionality ---
        function base64ToArrayBuffer(base64) {
            const binaryString = window.atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function pcmToWav(pcmData, sampleRate) {
            const numChannels = 1;
            const bytesPerSample = 2; // 16-bit PCM
            const blockAlign = numChannels * bytesPerSample;
            const byteRate = sampleRate * blockAlign;
            const dataSize = pcmData.length * bytesPerSample;
            const buffer = new ArrayBuffer(44 + dataSize);
            const view = new DataView(buffer);

            function writeString(view, offset, string) {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            }
            
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + dataSize, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, byteRate, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, 16, true);
            writeString(view, 36, 'data');
            view.setUint32(40, dataSize, true);

            for (let i = 0; i < pcmData.length; i++) {
                view.setInt16(44 + i * 2, pcmData[i], true);
            }

            return new Blob([view], { type: 'audio/wav' });
        }
        
        async function playTextAsSpeech(text, containerId, button) {
             const originalButtonHTML = button.innerHTML;
               button.disabled = true;
               button.innerHTML = `<span class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>`;

               const apiKey = "";
               const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
               const payload = {
                   contents: [{ parts: [{ text: `Diga de forma clara e informativa: ${text}` }] }],
                   generationConfig: {
                       responseModalities: ["AUDIO"],
                       speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } } }
                   },
                   model: "gemini-2.5-flash-preview-tts"
               };

               try {
                   const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                   if (!response.ok) throw new Error('TTS API Error');
                   
                   const result = await response.json();
                   const part = result?.candidates?.[0]?.content?.parts?.[0];
                   const audioData = part?.inlineData?.data;
                   const mimeType = part?.inlineData?.mimeType;

                   if (audioData && mimeType && mimeType.startsWith("audio/")) {
                       const sampleRateMatch = mimeType.match(/rate=(\d+)/);
                       const sampleRate = sampleRateMatch ? parseInt(sampleRateMatch[1], 10) : 24000;
                       const pcmData = base64ToArrayBuffer(audioData);
                       const pcm16 = new Int16Array(pcmData);
                       const wavBlob = pcmToWav(pcm16, sampleRate);
                       const audioUrl = URL.createObjectURL(wavBlob);
                       
                       const container = document.getElementById(containerId);
                       container.innerHTML = `<audio controls autoplay><source src="${audioUrl}" type="audio/wav"></audio>`;
                   } else {
                       throw new Error('Invalid audio data received.');
                   }
               } catch (error) {
                   console.error("TTS Error:", error);
                   document.getElementById(containerId).innerHTML = `<p class="text-red-400">${translations[currentLang].gemini_error}</p>`;
               } finally {
                   button.innerHTML = originalButtonHTML;
                   button.disabled = false;
                   button.style.display = 'none'; // Hide button after use to prevent replay issues
               }
        }


        // --- AI Image Generation ---
        async function generateImage() {
            const prompt = document.getElementById('imagePrompt').value;
            if (!prompt.trim()) { alert('Please enter a description for the image.'); return; }
            
            const button = document.getElementById('generateImageBtn');
            const resultDiv = document.getElementById('imageResult');
            const originalButtonText = button.innerHTML;

            button.disabled = true;
            button.innerHTML = `<span class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>`;
            resultDiv.innerHTML = `<div class="loader"></div><p class="text-center">${translations[currentLang].generating_image}</p>`;
            
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{
                    parts: [{ text: prompt }]
                }],
                generationConfig: {
                    responseModalities: ['TEXT', 'IMAGE']
                },
            };

            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error('Image API response not OK');

                const result = await response.json();
                const base64Data = result?.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
                if (base64Data) {
                    const imageUrl = `data:image/png;base64,${base64Data}`;
                    resultDiv.innerHTML = `<img src="${imageUrl}" alt="${prompt}" class="rounded-lg max-w-full max-h-96 mx-auto">`;
                } else {
                     throw new Error('Invalid image response structure');
                }
            } catch (error) {
                console.error('Image generation failed:', error);
                resultDiv.innerHTML = `<p>${translations[currentLang].gemini_error}</p>`;
            } finally {
                button.disabled = false;
                button.innerHTML = originalButtonText;
            }
        }
        
        // --- Study Planner ---
        async function generateStudyPlan() {
            const subject = document.getElementById('studySubject').value;
            const duration = document.getElementById('studyDuration').value;
            if (!subject.trim() || !duration.trim()) {
                alert(translations[currentLang].invalid_values);
                return;
            }

            const prompt = `Crie um plano de estudos detalhado para a matéria "${subject}" com duração de "${duration}".`;
            const button = document.getElementById('generatePlanBtn');
            const resultDiv = document.getElementById('studyPlanResult');
            const originalButtonText = button.innerHTML;

            button.disabled = true;
            button.innerHTML = `<span class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>`;
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = translations[currentLang].generating_response;
            animateResultBox(resultDiv);
            
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = {
              contents: [{ parts: [{ text: prompt }] }],
              generationConfig: {
                responseMimeType: "application/json",
                responseSchema: {
                  type: "OBJECT",
                  properties: {
                    plan: {
                      type: "ARRAY",
                      items: {
                        type: "OBJECT",
                        properties: {
                          day: { type: "STRING" },
                          topic: { type: "STRING" },
                          activities: { type: "ARRAY", items: { type: "STRING" } },
                          review_question: { type: "STRING" },
                        },
                      },
                    },
                  },
                },
              },
            };

            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error('API Error');
                const result = await response.json();
                const jsonText = result.candidates[0].content.parts[0].text;
                const parsedJson = JSON.parse(jsonText);
                
                let html = ``;
                parsedJson.plan.forEach(dayPlan => {
                    html += `<div class="p-3 my-2 bg-gray-700 rounded-lg">
                                <h3 class="text-lg font-bold text-purple-400">${dayPlan.day}: ${dayPlan.topic}</h3>
                                <p class="font-semibold mt-2">Atividades:</p>
                                <ul class="list-disc list-inside ml-4">
                                    ${dayPlan.activities.map(activity => `<li>${activity}</li>`).join('')}
                                </ul>
                                <p class="font-semibold mt-2">Questão de Revisão:</p>
                                <p class="italic">"${dayPlan.review_question}"</p>
                               </div>`;
                });
                resultDiv.innerHTML = html;
                addCopyButton(resultDiv);
            } catch (error) {
                console.error("Study plan generation error:", error);
                resultDiv.innerHTML = translations[currentLang].gemini_error;
            } finally {
                animateResultBox(resultDiv);
                button.disabled = false;
                button.innerHTML = originalButtonText;
            }
        }
        
        // --- Solve by Photo ---
        function previewImage(event) {
            const reader = new FileReader();
            const preview = document.getElementById('image-preview');
            reader.onload = function(){
                preview.src = reader.result;
                preview.classList.remove('hidden');
                currentImageBase64 = reader.result.split(',')[1];
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        async function solveByPhoto() {
            if (!currentImageBase64) {
                alert(translations[currentLang].no_image_selected);
                return;
            }

            const button = document.getElementById('solveByPhotoBtn');
            const resultDiv = document.getElementById('solveByPhotoResult');
            const originalButtonText = button.innerHTML;

            button.disabled = true;
            button.innerHTML = `<span class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>`;
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = translations[currentLang].generating_response;
            animateResultBox(resultDiv);

            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{
                    parts: [
                        { text: `Analise esta imagem e resolva o problema de matemática contido nela. Forneça uma explicação passo a passo em ${currentLang}.` },
                        { inlineData: { mimeType: "image/png", data: currentImageBase64 } }
                    ]
                }]
            };

            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error('API Error');
                const result = await response.json();
                const candidate = result.candidates?.[0];
                 if (candidate && candidate.content?.parts?.[0]?.text) {
                     let text = candidate.content.parts[0].text;
                     text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                     text = text.replace(/\* (.*?)/g, '&bull; $1');
                     text = text.replace(/(\r\n|\n|\r)/g, "<br>");
                     resultDiv.innerHTML = text;
                     addCopyButton(resultDiv);
                 } else {
                     throw new Error('Invalid response structure');
                 }
            } catch (error) {
                console.error("Solve by photo error:", error);
                resultDiv.innerHTML = translations[currentLang].gemini_error;
            } finally {
                animateResultBox(resultDiv);
                button.disabled = false;
                button.innerHTML = originalButtonText;
            }
        }

        // --- Formula Explainer ---
        function explainFormula() {
            const formulaName = document.getElementById('formulaInput').value;
            if (!formulaName.trim()) {
                alert(translations[currentLang].invalid_values);
                return;
            }
            const prompt = `Aja como um professor de matemática experiente. Explique a seguinte fórmula em detalhes: "${formulaName}". Sua explicação deve incluir:\n1. O que a fórmula representa.\n2. O que cada variável significa.\n3. Um exemplo prático de como usá-la.\nA explicação deve ser clara e didática, no idioma ${currentLang}.`;
            const button = document.getElementById('explainFormulaBtn');
            const resultDiv = document.getElementById('formulaResult');
            callGemini(prompt, button, resultDiv, 'formulaAudioPlayerContainer');
        }

        // --- Mind Map Generator ---
        async function generateMindMap() {
            const subject = document.getElementById('mindMapSubject').value;
            if (!subject.trim()) {
                alert(translations[currentLang].invalid_values);
                return;
            }
            const button = document.getElementById('generateMindMapBtn');
            const container = document.getElementById('mindMapContainer');
            const originalButtonText = button.innerHTML;
            
            button.disabled = true;
            button.innerHTML = `<span class="inline-block w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>`;
            container.innerHTML = `<div class="loader"></div>`;
            
            const prompt = `Crie um mapa mental sobre "${subject}". A estrutura deve ser um JSON com uma "ideia_central", e um array de "ramos" principais. Cada ramo deve ter um "titulo" e um array de "sub_ramos" (strings).`;
            const apiKey = "";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            ideia_central: { type: "STRING" },
                            ramos: {
                                type: "ARRAY",
                                items: {
                                    type: "OBJECT",
                                    properties: {
                                        titulo: { type: "STRING" },
                                        sub_ramos: { type: "ARRAY", items: { type: "STRING" } }
                                    }
                                }
                            }
                        }
                    }
                }
            };

            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) throw new Error('API Error');
                const result = await response.json();
                const jsonText = result.candidates[0].content.parts[0].text;
                const parsedJson = JSON.parse(jsonText);
                renderMindMap(parsedJson, container);
            } catch (error) {
                console.error("Mind map generation error:", error);
                container.innerHTML = `<p>${translations[currentLang].gemini_error}</p>`;
            } finally {
                button.disabled = false;
                button.innerHTML = originalButtonText;
            }
        }
        
        function renderMindMap(data, container) {
            container.innerHTML = '';
            const svgNS = "http://www.w3.org/2000/svg";
            const svg = document.createElementNS(svgNS, "svg");
            svg.setAttribute('id', 'mindMapSvg');
            container.appendChild(svg);
            
            const width = container.clientWidth;
            const height = 600; // Fixed height for now
            svg.setAttribute('viewBox', `0 0 ${width} ${height}`);

            const centerX = width / 2;
            const centerY = height / 2;
            const mainRadius = Math.min(width, height) / 3;
            const subRadius = 80;
            const nodeWidth = 120;
            const nodeHeight = 50;

            // Draw central idea
            createNode(svg, centerX, centerY, nodeWidth + 20, nodeHeight, data.ideia_central, "#8B5CF6");
            
            const numBranches = data.ramos.length;
            data.ramos.forEach((branch, i) => {
                const angle = (i / numBranches) * 2 * Math.PI;
                const bx = centerX + mainRadius * Math.cos(angle);
                const by = centerY + mainRadius * Math.sin(angle);
                createLine(svg, centerX, centerY, bx, by);
                createNode(svg, bx, by, nodeWidth, nodeHeight, branch.titulo, "#EC4899");

                const numSubBranches = branch.sub_ramos.length;
                branch.sub_ramos.forEach((sub, j) => {
                    const subAngle = (j / numSubBranches) * 2 * Math.PI + angle; // Offset angle
                    const sx = bx + subRadius * Math.cos(subAngle);
                    const sy = by + subRadius * Math.sin(subAngle);
                    createLine(svg, bx, by, sx, sy);
                    createNode(svg, sx, sy, nodeWidth - 20, nodeHeight - 15, sub, "#10B981");
                });
            });
        }
        
        function createNode(svg, x, y, w, h, text, color) {
            const g = document.createElementNS("http://www.w3.org/2000/svg", 'g');
            g.setAttribute('class', 'mind-map-node');
            
            const rect = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
            rect.setAttribute('x', x - w / 2);
            rect.setAttribute('y', y - h / 2);
            rect.setAttribute('width', w);
            rect.setAttribute('height', h);
            rect.setAttribute('rx', 10);
            rect.setAttribute('fill', color);
            
            const foreignObject = document.createElementNS("http://www.w3.org/2000/svg", 'foreignObject');
            foreignObject.setAttribute('x', x - w / 2);
            foreignObject.setAttribute('y', y - h / 2);
            foreignObject.setAttribute('width', w);
            foreignObject.setAttribute('height', h);
            
            const p = document.createElement('p');
            p.textContent = text;
            p.style.cssText = `font-family: 'Inter', sans-serif; font-size: 13px; color: white; text-align: center; padding: 4px; display: flex; align-items: center; justify-content: center; height: 100%; margin: 0; line-height: 1.2;`;
            
            foreignObject.appendChild(p);
            g.appendChild(rect);
            g.appendChild(foreignObject);
            svg.appendChild(g);
        }

        function createLine(svg, x1, y1, x2, y2) {
            const line = document.createElementNS("http://www.w3.org/2000/svg", 'line');
            line.setAttribute('x1', x1);
            line.setAttribute('y1', y1);
            line.setAttribute('x2', x2);
            line.setAttribute('y2', y2);
            line.setAttribute('stroke', '#4B5563');
            line.setAttribute('stroke-width', 2);
            svg.prepend(line); // Prepend to be behind nodes
        }


        // --- Live AI Tutor Chat (Optimized with Lockout) ---
        const offensiveWords = ['merda', 'bosta', 'caralho', 'puta', 'foder', 'cu', 'porra', 'viado', 'fuck', 'shit', 'bitch', 'cunt', 'asshole', 'pica', 'buceta', 'penis', 'sexo', 'anal', 'pau', 'sexo oral', 'rola', 'pinguelo', 'vagina', 'pqp', 'transar', 'puta que pariu', 'puto', 'putinha', 'vagabundo', 'canalha', 'desgraçado', 'desgraçada'];
        const politicalBlockWords = ['lula', 'bolsonaro', 'prisão', 'prisioneiro'];
        const apiChatUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=`;
        let lockoutInterval;

        function updateLockoutMessage() {
            const lockoutMessageDiv = document.getElementById('lockout-message');
            const lockoutEndTime = parseInt(localStorage.getItem('lockoutEndTime')) || 0;
            const now = Date.now();
            
            if (now < lockoutEndTime) {
                const remaining = lockoutEndTime - now;
                const hours = Math.floor((remaining / (1000 * 60 * 60)) % 24);
                const minutes = Math.floor((remaining / 1000 / 60) % 60);
                const seconds = Math.floor((remaining / 1000) % 60);
                let timeString = '';
                if (hours > 0) timeString += `${hours}h `;
                timeString += `${String(minutes).padStart(2, '0')}m ${String(seconds).padStart(2, '0')}s`;
                
                lockoutMessageDiv.style.display = 'block';
                lockoutMessageDiv.textContent = `${translations[currentLang].lockout_message_part1} ${timeString}`;
                document.getElementById('chatInput').disabled = true;
                document.getElementById('sendChatBtn').disabled = true;
            } else {
                lockoutMessageDiv.style.display = 'none';
                document.getElementById('chatInput').disabled = false;
                document.getElementById('sendChatBtn').disabled = false;
                clearInterval(lockoutInterval);
            }
        }
        
        function checkInitialLockout() {
            const lockoutEndTime = parseInt(localStorage.getItem('lockoutEndTime')) || 0;
            if (Date.now() < lockoutEndTime) {
                lockoutInterval = setInterval(updateLockoutMessage, 1000);
                updateLockoutMessage();
            }
        }
        
        async function sendChatMessage() {
            const lockoutEndTime = parseInt(localStorage.getItem('lockoutEndTime')) || 0;
            if (Date.now() < lockoutEndTime) {
                updateLockoutMessage();
                return;
            }
        
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            const chatWindow = document.getElementById('chatWindow');
            const responseStyle = document.getElementById('responseStyle').value;

            if (!message) return;

            const lowerCaseMessage = message.toLowerCase();
            
            // --- Improved Filter Logic ---
            const offensiveRegex = new RegExp(`\\b(${offensiveWords.join('|')})\\b`, 'i');
            const politicalRegex = new RegExp(`\\b(${politicalBlockWords.join('|')})\\b`, 'i');

            const isJustMath = /^[0-9\s+\-*/().^,]*$/.test(message);
            const containsPoliticalNumber = /\b(13|22)\b/.test(lowerCaseMessage);

            if (politicalRegex.test(lowerCaseMessage) || (containsPoliticalNumber && !isJustMath)) {
                const lockoutDuration = 4320; // 72 hours
                const newLockoutEndTime = Date.now() + lockoutDuration * 60 * 1000;
                localStorage.setItem('lockoutEndTime', newLockoutEndTime);
                localStorage.setItem('offensiveCount', 9);
                chatWindow.innerHTML += `<div class="text-left my-1" data-sender="system"><span class="bg-red-800 text-white rounded-lg px-3 py-1 inline-block">${translations[currentLang].lockout_political}</span></div>`;
                checkInitialLockout();
                chatWindow.scrollTop = chatWindow.scrollHeight;
                input.value = '';
                return;
            }

            if (offensiveRegex.test(lowerCaseMessage)) {
                let offensiveCount = parseInt(localStorage.getItem('offensiveCount')) || 0;
                offensiveCount++;
                localStorage.setItem('offensiveCount', offensiveCount);
                
                let lockoutDuration = 0;
                let lockoutMessageKey = '';
                
                if (offensiveCount === 3) { lockoutDuration = 5; lockoutMessageKey = 'lockout_level1_triggered'; }
                else if (offensiveCount === 6) { lockoutDuration = 10; lockoutMessageKey = 'lockout_level2_triggered'; }
                else if (offensiveCount >= 9) { lockoutDuration = 1440; lockoutMessageKey = 'lockout_level3_triggered'; }

                chatWindow.innerHTML += `<div class="text-left my-1" data-sender="system"><span class="bg-red-600 text-white rounded-lg px-3 py-1 inline-block">${translations[currentLang].offensive_message_blocked}</span></div>`;
                
                if (lockoutDuration > 0) {
                    const newLockoutEndTime = Date.now() + lockoutDuration * 60 * 1000;
                    localStorage.setItem('lockoutEndTime', newLockoutEndTime);
                    chatWindow.innerHTML += `<div class="text-left my-1" data-sender="system"><span class="bg-red-800 text-white rounded-lg px-3 py-1 inline-block">${translations[currentLang][lockoutMessageKey]}</span></div>`;
                    checkInitialLockout();
                }
                
                chatWindow.scrollTop = chatWindow.scrollHeight;
                input.value = '';
                return;
            }

            // --- Send message if clean ---
            chatWindow.innerHTML += `<div class="text-right my-1" data-sender="user"><span class="bg-purple-600 text-white rounded-lg px-3 py-1 inline-block">${message}</span></div>`;
            input.value = '';
            chatWindow.scrollTop = chatWindow.scrollHeight;

            const thinkingIndicatorHTML = `<div class="text-left my-1" data-sender="ai"><span class="bg-gray-600 text-white rounded-lg px-3 py-1 inline-block">...</span></div>`;
            chatWindow.insertAdjacentHTML('beforeend', thinkingIndicatorHTML);
            chatWindow.scrollTop = chatWindow.scrollHeight;
            
            const thinkingDiv = chatWindow.lastElementChild;
            
            const styleInstruction = responseStyle === 'objetiva' ? 'Seja breve e direto na resposta.' : 'Forneça uma resposta detalhada com explicações passo a passo.';
            const prompt = `
                Você é o "Tutor IA" da plataforma INFINITY MIND's. Sua função é ser um assistente educacional amigável e seguro.
                A pergunta do usuário é: "${message}".
                **REGRAS E DIRETRIZES ESTRITAS:**
                1.  **NÃO RESPONDA** a perguntas que sejam sexualmente explícitas, violentas, ofensivas, ou que promovam atividades ilegais ou perigosas. Se a pergunta se enquadrar nesta categoria, responda APENAS com: "${translations[currentLang].inappropriate_topic_refused}"
                2.  Evite tópicos políticos sensíveis.
                3.  Se a pergunta for segura e apropriada, responda ao usuário. Siga esta instrução de estilo: ${styleInstruction}.
                A resposta final deve ser no idioma ${currentLang}. Não use formatação markdown como ###, ##, ou ***. Use negrito (**) e quebras de linha se necessário.
            `;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            try {
                const response = await fetch(apiChatUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                 if (!response.ok) throw new Error('API Error');
                 const result = await response.json();
                 const candidate = result.candidates?.[0];
                 if (candidate && candidate.content?.parts?.[0]?.text) {
                     let text = candidate.content.parts[0].text;
                     text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                     text = text.replace(/\* (.*?)/g, '&bull; $1');
                     text = text.replace(/(\r\n|\n|\r)/g, "<br>");
                     thinkingDiv.querySelector('span').innerHTML = text;
                 } else {
                     throw new Error('Invalid response structure');
                 }
            } catch (error) {
                const span = thinkingDiv.querySelector('span');
                span.innerHTML = translations[currentLang].gemini_error;
                span.className = "bg-red-500 text-white rounded-lg px-3 py-1 inline-block";
                console.error("Chat error:", error);
            } finally {
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }
        }
        document.getElementById('chatInput').addEventListener('keypress', function(e) { if (e.key === 'Enter') sendChatMessage(); });

        function downloadChat() {
            const chatWindow = document.getElementById('chatWindow');
            let chatText = "Conversa com o Tutor IA - INFINITY MIND's\n\n";
            chatWindow.querySelectorAll('div[data-sender]').forEach(messageDiv => {
                const sender = messageDiv.getAttribute('data-sender');
                const text = messageDiv.querySelector('span').innerText;
                if (sender === 'user') {
                    chatText += `Você: ${text}\n`;
                } else {
                    chatText += `Tutor IA: ${text}\n`;
                }
                chatText += '---------------------------------\n';
            });

            const blob = new Blob([chatText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'conversa-infinity-minds.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // --- Financial Planner ---
        function getFinancialAdvice() {
            const query = document.getElementById('financialQuery').value;
            if (!query.trim()) { alert('Please enter your goal or question.'); return; }
            const prompt = `Aja como um educador financeiro. Forneça dicas e um plano de ação sobre o seguinte tópico: "${query}". A resposta deve ser simples, didática e encorajadora. Não dê conselhos financeiros diretos ou recomendações de produtos específicos. O idioma da resposta deve ser ${currentLang}.`;
            const button = document.getElementById('getAdviceBtn');
            const resultDiv = document.getElementById('financialResult');
            callGemini(prompt, button, resultDiv);
        }

        // --- Exercise Generator ---
        function generateExercises() {
            const subject = document.getElementById('exerciseSubject').value;
            const count = document.getElementById('exerciseCount').value;
            const level = document.getElementById('exerciseLevel').value;
            const type = document.getElementById('exerciseType').value;
            if (!subject.trim()) { alert('Please enter a subject.'); return; }

            const prompt = `Crie ${count} exercícios sobre "${subject}" para um estudante do 9º ano. O nível de dificuldade deve ser ${level}. As questões devem ser do tipo ${type}. Se forem objetivas, inclua 4 alternativas e indique a resposta correta no final. Formate a resposta de forma clara, numerando as questões. A resposta deve ser no idioma ${currentLang}.`;
            const button = document.getElementById('generateExercisesBtn');
            const resultDiv = document.getElementById('exerciseResult');
            callGemini(prompt, button, resultDiv);
        }

        // --- System of Equations Solver ---
        function solveSystemOfEquations() {
            const values = ['a1', 'b1', 'c1', 'a2', 'b2', 'c2'].map(id => parseFloat(document.getElementById(`eq_${id}`).value));
            if (values.some(isNaN)) {
                alert(translations[currentLang].invalid_values);
                return;
            }
            const [a1, b1, c1, a2, b2, c2] = values;
            const resultDiv = document.getElementById('equationsResult');
            
            const D = a1 * b2 - a2 * b1;
            if (D === 0) {
                resultDiv.innerHTML = `<strong>${translations[currentLang].equations_no_solution}</strong>`;
                animateResultBox(resultDiv);
                return;
            }
            
            const Dx = c1 * b2 - c2 * b1;
            const Dy = a1 * c2 - a2 * c1;
            const x = Dx / D;
            const y = Dy / D;

            resultDiv.innerHTML = `<strong>x = ${x.toFixed(4)}</strong> <br> <strong>y = ${y.toFixed(4)}</strong>`;
            animateResultBox(resultDiv);
        }

        function solveWordProblem() {
            const problem = document.getElementById('wordProblem').value;
            if (!problem.trim()) { alert('Por favor, digite um problema de matemática.'); return; }
            const prompt = `Resolva o seguinte problema de matemática em ${currentLang}: "${problem}". Apresente a solução passo a passo e, em seguida, a resposta final de forma clara.`;
            const button = document.getElementById('solveProblemBtn');
            const resultDiv = document.getElementById('wordProblemResult');
            callGemini(prompt, button, resultDiv, 'wpAudioPlayerContainer');
        }

        function summarizeSubject() {
            const subject = document.getElementById('subjectInput').value;
            if (!subject.trim()) { alert('Por favor, digite um assunto.'); return; }
            const prompt = `Crie um resumo sobre o seguinte tópico: "${subject}". O resumo deve ser claro, conciso e adequado para um estudante do 9º ano. Explique os conceitos principais de forma simples. O idioma do resumo deve ser ${currentLang}.`;
            const button = document.getElementById('summarizeBtn');
            const resultDiv = document.getElementById('summarizerResult');
            callGemini(prompt, button, resultDiv, 'summarizerAudioPlayerContainer');
        }
        
        const display = document.getElementById('basicCalcDisplay');
        function appendToDisplay(value) { display.value += value; }
        function clearDisplay() { display.value = ''; }
        function calculateResult() {
            try { display.value = eval(display.value.replace(/[^0-9+\-*/.]/g, '')); } 
            catch (error) { display.value = 'Error'; }
        }

        function calculateBMI() {
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const resultDiv = document.getElementById('bmiResult');
            const tipsBtn = document.getElementById('bmiTipsBtn');
            if (isNaN(weight) || isNaN(height) || weight <= 0 || height <= 0) {
                resultDiv.textContent = translations[currentLang].invalid_values;
                animateResultBox(resultDiv);
                return;
            }
            const bmi = weight / ((height / 100) ** 2);
            const bmiFormatted = bmi.toFixed(2);
            let categoryKey = bmi < 18.5 ? 'underweight' : bmi < 24.9 ? 'normal_weight' : bmi < 29.9 ? 'overweight' : 'obesity';
            const category = translations[currentLang][categoryKey];
            resultDiv.innerHTML = `${translations[currentLang].bmi_is} <strong>${bmiFormatted}</strong>. <br> ${translations[currentLang].classification}: ${category}`;
            animateResultBox(resultDiv);
            lastBmiData = { bmi: bmiFormatted, category };
            tipsBtn.style.display = 'block';
            document.getElementById('bmiTipsResult').style.display = 'none';
        }
        
        function getBmiTips() {
            const { bmi, category } = lastBmiData;
            if (!bmi) return;
            const prompt = `Meu Índice de Massa Corporal (IMC) é ${bmi}, classificado como '${category}'. Forneça, no idioma ${currentLang}, 5 dicas gerais e práticas de saúde e bem-estar para alguém nesta categoria. Não ofereça conselhos médicos, apenas sugestões de estilo de vida.`;
            const button = document.getElementById('bmiTipsBtn');
            const resultDiv = document.getElementById('bmiTipsResult');
            callGemini(prompt, button, resultDiv);
        }

        function solveQuadratic() {
            const a = parseFloat(document.getElementById('coeffA').value);
            const b = parseFloat(document.getElementById('coeffB').value);
            const c = parseFloat(document.getElementById('coeffC').value);
            const resultDiv = document.getElementById('quadraticResult');
            const explainBtn = document.getElementById('quadraticExplainBtn');
            if (isNaN(a) || isNaN(b) || isNaN(c)) { resultDiv.textContent = translations[currentLang].missing_coeffs; animateResultBox(resultDiv); return; }
            if (a === 0) { resultDiv.textContent = translations[currentLang].coeff_a_zero; animateResultBox(resultDiv); return; }
            const delta = (b ** 2) - (4 * a * c);
            if (delta > 0) {
                const x1 = (-b + Math.sqrt(delta)) / (2 * a);
                const x2 = (-b - Math.sqrt(delta)) / (2 * a);
                resultDiv.innerHTML = `${translations[currentLang].two_real_roots}: <br><strong>x1 = ${x1.toFixed(4)}, x2 = ${x2.toFixed(4)}</strong>`;
            } else if (delta === 0) {
                const x = -b / (2 * a);
                resultDiv.innerHTML = `${translations[currentLang].one_real_root}: <br><strong>x = ${x.toFixed(4)}</strong>`;
            } else {
                const realPart = (-b / (2 * a)).toFixed(4);
                const imagPart = (Math.sqrt(-delta) / (2 * a)).toFixed(4);
                resultDiv.innerHTML = `${translations[currentLang].complex_roots}: <br><strong>x1 = ${realPart} + ${imagPart}i, x2 = ${realPart} - ${imagPart}i</strong>`;
            }
            animateResultBox(resultDiv);
            lastQuadraticData = { a, b, c };
            explainBtn.style.display = 'block';
            document.getElementById('quadraticExplainResult').style.display = 'none';
        }
        
        function explainQuadraticSteps() {
            const { a, b, c } = lastQuadraticData;
            if (a === undefined) return;
            const prompt = `Explique no idioma ${currentLang}, passo a passo, como resolver a seguinte equação quadrática usando a fórmula de Bhaskara: ${a}x² + ${b}x + ${c} = 0. Seja claro e didático, mostrando o cálculo do delta e das raízes.`;
            const button = document.getElementById('quadraticExplainBtn');
            const resultDiv = document.getElementById('quadraticExplainResult');
            callGemini(prompt, button, resultDiv);
        }
        
        const currencies = {
            "BRL": "Real Brasileiro", "USD": "Dólar Americano", "EUR": "Euro", "GBP": "Libra Esterlina", 
            "CNY": "Yuan Chinês", "ARS": "Peso Argentino", "PYG": "Guarani Paraguaio"
        };
        const fromCurrency = document.getElementById('from_currency');
        const toCurrency = document.getElementById('to_currency');
        for (const code in currencies) {
            fromCurrency.innerHTML += `<option value="${code}">${code} - ${currencies[code]}</option>`;
            toCurrency.innerHTML += `<option value="${code}">${code} - ${currencies[code]}</option>`;
        }
        fromCurrency.value = "BRL";
        toCurrency.value = "USD";
        
        async function convertCurrency() {
            const amount = parseFloat(document.getElementById('amount').value);
            const from = fromCurrency.value;
            const to = toCurrency.value;
            const resultDiv = document.getElementById('currencyResult');
            if (isNaN(amount) || amount <= 0) {
                resultDiv.textContent = translations[currentLang].invalid_values;
                animateResultBox(resultDiv);
                return;
            }
            try {
                const response = await fetch(`https://open.er-api.com/v6/latest/${from}`);
                if (!response.ok) throw new Error('API Error');
                const data = await response.json();
                const rate = data.rates[to];
                const result = (amount * rate).toFixed(2);
                resultDiv.innerHTML = `<strong>${amount.toFixed(2)} ${from} = ${result} ${to}</strong><br><small>1 ${from} = ${rate.toFixed(4)} ${to}</small>`;
            } catch (error) {
                console.error("Currency API error:", error);
                resultDiv.textContent = translations[currentLang].currency_error;
            }
            animateResultBox(resultDiv);
        }

        function convertTemp(conversionType) {
            const celsiusInput = document.getElementById('celsius');
            const fahrenheitInput = document.getElementById('fahrenheit');
            if (conversionType === 'c_to_f') {
                const celsius = parseFloat(celsiusInput.value);
                fahrenheitInput.value = isNaN(celsius) ? '' : ((celsius * 9/5) + 32).toFixed(2);
            } else if (conversionType === 'f_to_c') {
                const fahrenheit = parseFloat(fahrenheitInput.value);
                celsiusInput.value = isNaN(fahrenheit) ? '' : ((fahrenheit - 32) * 5/9).toFixed(2);
            }
        }
        
        function calculatePercentage() {
            const percent = parseFloat(document.getElementById('percentValue').value);
            const base = parseFloat(document.getElementById('baseValue').value);
            const resultDiv = document.getElementById('percentageResult');
            if (isNaN(percent) || isNaN(base)) {
                resultDiv.textContent = translations[currentLang].invalid_values;
                animateResultBox(resultDiv);
                return;
            }
            const result = (percent / 100) * base;
            resultDiv.textContent = `${percent}% ${translations[currentLang].percentage_of} ${base} ${translations[currentLang].percentage_result_is} ${result.toFixed(2)}`;
            animateResultBox(resultDiv);
        }

        function plotFunction() {
            const funcStr = document.getElementById('functionInput').value;
            const xMin = parseFloat(document.getElementById('xMin').value);
            const xMax = parseFloat(document.getElementById('xMax').value);

            if (!funcStr || isNaN(xMin) || isNaN(xMax) || xMin >= xMax) {
                alert(translations[currentLang].invalid_values);
                return;
            }

            if (chartInstance) {
                chartInstance.destroy();
            }

            try {
                const node = math.parse(funcStr);
                const code = node.compile();

                const labels = [];
                const data = [];
                const step = (xMax - xMin) / 100; // 101 data points

                for (let x = xMin; x <= xMax; x += step) {
                    labels.push(x.toFixed(2));
                    data.push(code.evaluate({ x: x }));
                }

                const ctx = document.getElementById('functionChart').getContext('2d');
                chartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: `f(x) = ${funcStr}`,
                            data: data,
                            borderColor: '#8B5CF6',
                            backgroundColor: 'rgba(139, 92, 246, 0.2)',
                            borderWidth: 2,
                            pointRadius: 0,
                            tension: 0.1
                        }]
                    },
                    options: {
                        animation: {
                            duration: 1000,
                            easing: 'easeInOutQuad'
                        },
                        scales: {
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#D1D5DB' }
                            },
                            y: {
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: { color: '#D1D5DB' }
                            }
                        },
                        plugins: {
                            legend: {
                                labels: { color: '#D1D5DB' }
                            }
                        }
                    }
                });

            } catch (err) {
                console.error(err);
                alert("Função inválida. Use 'x' como variável. Ex: 2*x^2 + sin(x)");
            }
        }


        document.addEventListener('DOMContentLoaded', () => {
            changeLanguage('pt-br');
            
            // --- Draggable Tools Initialization ---
            const toolGrid = document.getElementById('tool-grid');
            new Sortable(toolGrid, {
                animation: 150,
                ghostClass: 'bg-purple-600/30', // A class for the drop placeholder
                onEnd: function () {
                    const order = Array.from(toolGrid.children).map(el => el.dataset.toolId);
                    localStorage.setItem('toolOrder', JSON.stringify(order));
                }
            });

            // Load tool order from localStorage
            const savedOrder = JSON.parse(localStorage.getItem('toolOrder'));
            if (savedOrder) {
                const items = Array.from(toolGrid.children);
                const orderedItems = savedOrder.map(id => items.find(item => item.dataset.toolId === id)).filter(Boolean);
                const remainingItems = items.filter(item => !savedOrder.includes(item.dataset.toolId));
                orderedItems.concat(remainingItems).forEach(item => toolGrid.appendChild(item));
            }

            document.querySelectorAll('.menu-card').forEach((card, index) => {
                card.style.animationDelay = `${index * 50}ms`;
            });
        });
    </script>
</body>
</html>
